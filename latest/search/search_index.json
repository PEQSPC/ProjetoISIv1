{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"ProjetoISIv1 - Monitoriza\u00e7\u00e3o Industrial com ETL e IoT","text":"<p>Bem-vindo \u00e0 documenta\u00e7\u00e3o do ProjetoISIv1, um sistema de monitoriza\u00e7\u00e3o industrial que evoluiu para uma plataforma de simula\u00e7\u00e3o IoT.</p>"},{"location":"#sobre-o-projeto","title":"Sobre o Projeto","text":"<p>Este projeto nasceu como trabalho pr\u00e1tico da UC de Integra\u00e7\u00e3o de Sistemas de Informa\u00e7\u00e3o (ISI) da LESI-IPCA e cresceu para algo maior.</p>"},{"location":"#fase-1-trabalho-academico-out-dez-2024","title":"Fase 1: Trabalho Acad\u00e9mico (Out-Dez 2024)","text":"<p>Sistema de monitoriza\u00e7\u00e3o industrial com recolha autom\u00e1tica de dados de esta\u00e7\u00f5es de produ\u00e7\u00e3o via MQTT, processamento ETL em Node-RED, e visualiza\u00e7\u00e3o em tempo real.</p> <p>Objetivo: Aplicar conceitos de integra\u00e7\u00e3o de sistemas e ETL num contexto industrial pr\u00e1tico.</p>"},{"location":"#fase-2-plataforma-iot-simulator-jan-2025","title":"Fase 2: Plataforma IoT Simulator (Jan 2025+)","text":"<p>Evolu\u00e7\u00e3o para uma plataforma comercial que permite a programadores testar aplica\u00e7\u00f5es IoT sem hardware f\u00edsico, criando sensores virtuais sob demanda.</p> <p>Objetivo: Validar viabilidade comercial de uma solu\u00e7\u00e3o SaaS para simula\u00e7\u00e3o IoT.</p> <p>L\u00ea mais: Contexto e Evolu\u00e7\u00e3o do Projeto</p>"},{"location":"#stack-tecnologica","title":"Stack Tecnol\u00f3gica","text":"<p>Backend: Python, Node-RED, SQLite, Mosquitto MQTT Frontend: React, Material-UI DevOps: Docker, FastAPI (Fase 2)</p>"},{"location":"#estrutura-da-documentacao","title":"Estrutura da Documenta\u00e7\u00e3o","text":""},{"location":"#conceito-e-arquitetura","title":"Conceito e Arquitetura","text":"<ul> <li>Contexto do Projeto - Evolu\u00e7\u00e3o Fase 1 \u2192 Fase 2</li> <li>Arquitetura T\u00e9cnica - Componentes e fluxo de dados</li> <li>Processos ETL - Pipeline de dados</li> </ul>"},{"location":"#dados-e-integracoes","title":"Dados e Integra\u00e7\u00f5es","text":"<ul> <li>Base de Dados - Schema e queries principais</li> <li>Integra\u00e7\u00e3o API - Pre\u00e7os de pe\u00e7as em tempo real</li> <li>Azure IoT Hub - Telemetria para cloud</li> <li>Relat\u00f3rios e Emails - Automa\u00e7\u00e3o de relat\u00f3rios</li> </ul>"},{"location":"#implementacao","title":"Implementa\u00e7\u00e3o","text":"<ul> <li>Instala\u00e7\u00e3o - Setup do ambiente</li> <li>Dashboard - Interface de visualiza\u00e7\u00e3o</li> <li>Troubleshooting - Problemas comuns</li> </ul>"},{"location":"#futuro","title":"Futuro","text":"<ul> <li>Fase 2 - IoT Simulator Platform - Roadmap comercial</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># 1. Clonar reposit\u00f3rio\ngit clone https://github.com/PEQSPC/ProjetoISIv1\ncd ProjetoISIv1\n\n# 2. Iniciar broker MQTT\nmosquitto -c mosquitto.conf\n\n# 3. Iniciar Node-RED\nnode-red\n\n# 4. Executar simulador\npython simulador/mqtt_publisher.py\n\n# 5. Ver dashboard\ncd dashboard &amp;&amp; npm start\n</code></pre> <p>Detalhes completos em Instala\u00e7\u00e3o.</p>"},{"location":"#o-problema-resolvido","title":"O Problema Resolvido","text":"<p>Antes: Recolha manual de dados, sem vis\u00e3o integrada, dificuldade em identificar problemas.</p> <p>Depois: Monitoriza\u00e7\u00e3o autom\u00e1tica em tempo real, alertas autom\u00e1ticos, relat\u00f3rios por email, dashboard interativo.</p> <p>M\u00e9tricas: Produ\u00e7\u00e3o, paragens, stock, defeitos, efici\u00eancia (OEE).</p>"},{"location":"#navegacao-recomendada","title":"Navega\u00e7\u00e3o Recomendada","text":"<p>Novo no projeto? 1. Contexto do Projeto - Entende a vis\u00e3o 2. Instala\u00e7\u00e3o - Configura o ambiente 3. Dashboard - V\u00ea os dados ao vivo</p> <p>Implementador t\u00e9cnico? 1. Arquitetura - Compreende o sistema 2. ETL - Fluxos de processamento 3. Base de Dados - Modelo de dados</p> <p>Interessado no futuro? 1. Fase 2 Roadmap - Plataforma comercial</p>"},{"location":"#informacao-do-projeto","title":"Informa\u00e7\u00e3o do Projeto","text":"<p>Institui\u00e7\u00e3o: IPCA - Instituto Polit\u00e9cnico do C\u00e1vado e do Ave Curso: Licenciatura em Engenharia de Sistemas Inform\u00e1ticos (LESI) UC: Integra\u00e7\u00e3o de Sistemas de Informa\u00e7\u00e3o (ISI) Ano Letivo: 2024/25 Equipa: PEQSPC Reposit\u00f3rio: github.com/PEQSPC/ProjetoISIv1</p> <p>Nota: Esta documenta\u00e7\u00e3o cobre ambas as fases do projeto. Para detalhes da Fase 2 (plataforma comercial), consulta o roadmap espec\u00edfico.</p>"},{"location":"api-integracao/","title":"Integra\u00e7\u00e3o com API de Pre\u00e7os","text":"<p>Sistema de enriquecimento de dados de produ\u00e7\u00e3o com pre\u00e7os de pe\u00e7as atrav\u00e9s de API externa.</p>"},{"location":"api-integracao/#objetivo","title":"Objetivo","text":"<p>Calcular o valor monet\u00e1rio da produ\u00e7\u00e3o em tempo real, combinando: - Dados de produ\u00e7\u00e3o (quantas pe\u00e7as foram produzidas) - Pre\u00e7os unit\u00e1rios obtidos via API externa</p> <p>Resultado: M\u00e9tricas financeiras autom\u00e1ticas (receita estimada, margem, custo de defeitos).</p>"},{"location":"api-integracao/#arquitetura","title":"Arquitetura","text":"<pre><code>MQTT Sensor \u2192 Node-RED \u2192 Extrai C\u00f3digo Produto (regex)\n                              \u2193\n                        HTTP Request \u2192 API Externa\n                              \u2193\n                    Recebe Pre\u00e7o Unit\u00e1rio\n                              \u2193\n                  Calcula: Pre\u00e7o \u00d7 Produ\u00e7\u00e3o\n                              \u2193\n                      Armazena em SQLite\n</code></pre>"},{"location":"api-integracao/#api-externa","title":"API Externa","text":""},{"location":"api-integracao/#endpoint-utilizado","title":"Endpoint Utilizado","text":"<p>Assumindo uma API REST que retorna pre\u00e7os de produtos:</p> <pre><code>GET https://api.empresa.com/produtos/{codigo}/preco\n</code></pre> <p>Resposta: <pre><code>{\n  \"codigo\": \"PCB-001\",\n  \"nome\": \"Placa de Circuito Tipo A\",\n  \"preco_unitario\": 15.50,\n  \"moeda\": \"EUR\",\n  \"ultima_atualizacao\": \"2024-12-28T10:00:00Z\"\n}\n</code></pre></p>"},{"location":"api-integracao/#alternativa-api-publica-mockada","title":"Alternativa: API P\u00fablica Mockada","text":"<p>Para testes, pode-se usar: - JSONPlaceholder - Mocky.io - API pr\u00f3pria com Express/FastAPI</p>"},{"location":"api-integracao/#implementacao-no-node-red","title":"Implementa\u00e7\u00e3o no Node-RED","text":""},{"location":"api-integracao/#flow-completo","title":"Flow Completo","text":"<pre><code>[MQTT In] \u2192 [Extrair C\u00f3digo] \u2192 [HTTP Request] \u2192 [Calcular Valor] \u2192 [SQLite]\n                                                                    \u2193\n                                                              [Debug Output]\n</code></pre>"},{"location":"api-integracao/#1-extrair-codigo-do-produto","title":"1. Extrair C\u00f3digo do Produto","text":"<p>Node: <code>function</code> - \"Extrair C\u00f3digo Produto\"</p> <pre><code>// Entrada: msg.payload = {codigo_produto: \"PCB-001\", dados: {...}}\n// Sa\u00edda: msg.codigo_produto = \"PCB-001\"\n\nif (msg.payload.codigo_produto) {\n    msg.codigo_produto = msg.payload.codigo_produto;\n\n    // Guardar dados originais para uso posterior\n    flow.set('ultimo_payload', msg.payload);\n\n    return msg;\n} else {\n    node.warn(\"C\u00f3digo de produto n\u00e3o encontrado\");\n    return null;\n}\n</code></pre> <p>Configura\u00e7\u00e3o: - Nome: \"Extrair C\u00f3digo Produto\" - Outputs: 1</p>"},{"location":"api-integracao/#2-consultar-api-de-precos","title":"2. Consultar API de Pre\u00e7os","text":"<p>Node: <code>http request</code> - \"Buscar Pre\u00e7o API\"</p> <p>Configura\u00e7\u00e3o: - Method: GET - URL: <code>https://api.empresa.com/produtos/{{codigo_produto}}/preco</code> - Return: parsed JSON object - Headers:   - <code>Authorization</code>: <code>Bearer {{env.API_TOKEN}}</code>   - <code>Content-Type</code>: <code>application/json</code></p> <p>Alternativa com Template URL:</p> <p>Se a API requerer formato diferente: <pre><code>// Node function antes do HTTP request\nmsg.url = `https://api.empresa.com/produtos/${msg.codigo_produto}/preco`;\nreturn msg;\n</code></pre></p>"},{"location":"api-integracao/#3-calcular-valor-da-producao","title":"3. Calcular Valor da Produ\u00e7\u00e3o","text":"<p>Node: <code>function</code> - \"Calcular Valor Total\"</p> <pre><code>// msg.payload agora tem dados da API (preco_unitario)\n// Recuperar dados originais do flow context\n\nlet dados_producao = flow.get('ultimo_payload');\nlet preco_unitario = msg.payload.preco_unitario;\n\nif (!preco_unitario || !dados_producao) {\n    node.warn(\"Dados incompletos para c\u00e1lculo\");\n    return null;\n}\n\n// Calcular valores\nlet producao = dados_producao.dados.producao;\nlet defeitos = dados_producao.dados.defeitos;\n\nlet valor_producao = producao * preco_unitario;\nlet valor_perdido_defeitos = defeitos * preco_unitario;\nlet valor_liquido = valor_producao - valor_perdido_defeitos;\n\n// Montar payload para BD\nmsg.payload = {\n    estacao: dados_producao.estacao,\n    codigo_produto: dados_producao.codigo_produto,\n    timestamp: dados_producao.timestamp,\n    producao: producao,\n    preco_unitario: preco_unitario,\n    valor_producao: valor_producao.toFixed(2),\n    defeitos: defeitos,\n    valor_perdido: valor_perdido_defeitos.toFixed(2),\n    valor_liquido: valor_liquido.toFixed(2)\n};\n\n// Query SQL para inser\u00e7\u00e3o\nmsg.topic = `\nINSERT INTO producao_valores \n(estacao_id, codigo_produto, timestamp, producao, preco_unitario, \n valor_producao, defeitos, valor_perdido, valor_liquido)\nVALUES \n('${msg.payload.estacao}', '${msg.payload.codigo_produto}', \n '${msg.payload.timestamp}', ${msg.payload.producao}, \n ${msg.payload.preco_unitario}, ${msg.payload.valor_producao}, \n ${msg.payload.defeitos}, ${msg.payload.valor_perdido}, \n ${msg.payload.valor_liquido})\n`;\n\nreturn msg;\n</code></pre>"},{"location":"api-integracao/#4-armazenar-em-base-de-dados","title":"4. Armazenar em Base de Dados","text":"<p>Node: <code>sqlite</code> - \"Gravar Valores Produ\u00e7\u00e3o\"</p> <p>Configura\u00e7\u00e3o: - Database: <code>/path/to/industrial_monitoring.db</code> - SQL Query: <code>msg.topic</code> (definido na fun\u00e7\u00e3o anterior)</p>"},{"location":"api-integracao/#regex-para-produtos-diversos","title":"Regex para Produtos Diversos","text":"<p>Se a API retorna m\u00faltiplos produtos e voc\u00ea precisa filtrar:</p> <p>Cen\u00e1rio: API retorna lista de 100 produtos, voc\u00ea quer apenas IDs espec\u00edficos.</p> <p>Node: <code>function</code> - \"Filtrar Produtos Relevantes\"</p> <pre><code>// msg.payload = [{id: 1, preco: 10}, {id: 2, preco: 20}, ...]\n// Produtos que interessam: IDs 5, 12, 23\n\nlet produtos_interesse = [5, 12, 23];\nlet regex_ids = new RegExp(`^(${produtos_interesse.join('|')})$`);\n\nlet produtos_filtrados = msg.payload.filter(produto =&gt; {\n    return regex_ids.test(produto.id.toString());\n});\n\nif (produtos_filtrados.length === 0) {\n    node.warn(\"Nenhum produto relevante encontrado\");\n    return null;\n}\n\n// Guardar no contexto para uso posterior\nflow.set('produtos_precos', produtos_filtrados);\n\nmsg.payload = produtos_filtrados;\nreturn msg;\n</code></pre>"},{"location":"api-integracao/#tabela-de-base-de-dados","title":"Tabela de Base de Dados","text":""},{"location":"api-integracao/#schema-sql","title":"Schema SQL","text":"<pre><code>CREATE TABLE producao_valores (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    estacao_id INTEGER,\n    codigo_produto TEXT,\n    timestamp DATETIME,\n    producao INTEGER,\n    preco_unitario REAL,\n    valor_producao REAL,\n    defeitos INTEGER,\n    valor_perdido REAL,\n    valor_liquido REAL,\n    FOREIGN KEY (estacao_id) REFERENCES estacoes(id)\n);\n\nCREATE INDEX idx_producao_valores_timestamp \nON producao_valores(timestamp DESC);\n</code></pre>"},{"location":"api-integracao/#consultas-uteis","title":"Consultas \u00dateis","text":"<p>Valor total produzido hoje: <pre><code>SELECT SUM(valor_liquido) as receita_diaria\nFROM producao_valores\nWHERE DATE(timestamp) = DATE('now');\n</code></pre></p> <p>Top 3 produtos por receita (\u00faltima semana): <pre><code>SELECT \n    codigo_produto,\n    SUM(valor_producao) as receita_total,\n    SUM(valor_perdido) as perdas_defeitos\nFROM producao_valores\nWHERE timestamp &gt;= datetime('now', '-7 days')\nGROUP BY codigo_produto\nORDER BY receita_total DESC\nLIMIT 3;\n</code></pre></p> <p>Custo de defeitos por esta\u00e7\u00e3o: <pre><code>SELECT \n    e.nome,\n    SUM(pv.valor_perdido) as custo_defeitos\nFROM producao_valores pv\nJOIN estacoes e ON pv.estacao_id = e.id\nWHERE DATE(pv.timestamp) = DATE('now')\nGROUP BY e.nome;\n</code></pre></p>"},{"location":"api-integracao/#gestao-de-erros","title":"Gest\u00e3o de Erros","text":""},{"location":"api-integracao/#tratamento-de-falhas-na-api","title":"Tratamento de Falhas na API","text":"<p>Node: <code>catch</code> - \"Erro API\"</p> <p>Adicionar node catch que captura erros do HTTP request:</p> <pre><code>// Node function conectado ao catch\nif (msg.error) {\n    node.error(`API falhou: ${msg.error.message}`);\n\n    // Usar pre\u00e7o padr\u00e3o/\u00faltimo conhecido\n    let ultimo_preco = flow.get(`preco_${msg.codigo_produto}`) || 0;\n\n    msg.payload = {\n        preco_unitario: ultimo_preco,\n        fonte: \"cache\",\n        aviso: \"API indispon\u00edvel - usando \u00faltimo pre\u00e7o conhecido\"\n    };\n\n    return msg;\n}\n</code></pre>"},{"location":"api-integracao/#cache-de-precos","title":"Cache de Pre\u00e7os","text":"<p>Evitar chamadas repetidas para o mesmo produto:</p> <pre><code>// No in\u00edcio do flow de pre\u00e7os\nlet codigo = msg.codigo_produto;\nlet cache_preco = flow.get(`preco_cache_${codigo}`);\nlet cache_timestamp = flow.get(`preco_cache_ts_${codigo}`);\n\n// Cache v\u00e1lido por 1 hora\nif (cache_preco &amp;&amp; cache_timestamp) {\n    let agora = Date.now();\n    let diff_minutos = (agora - cache_timestamp) / 1000 / 60;\n\n    if (diff_minutos &lt; 60) {\n        node.warn(`Usando pre\u00e7o em cache para ${codigo}`);\n        msg.payload = {preco_unitario: cache_preco};\n        return msg;\n    }\n}\n\n// Se n\u00e3o h\u00e1 cache v\u00e1lido, prosseguir para HTTP request\nreturn msg;\n</code></pre> <p>Ap\u00f3s receber resposta da API: <pre><code>// Guardar em cache\nflow.set(`preco_cache_${msg.codigo_produto}`, msg.payload.preco_unitario);\nflow.set(`preco_cache_ts_${msg.codigo_produto}`, Date.now());\n</code></pre></p>"},{"location":"api-integracao/#rate-limiting","title":"Rate Limiting","text":"<p>Se a API tem limite de requests:</p> <pre><code>// Antes do HTTP request\nlet ultima_chamada = flow.get('api_ultima_chamada') || 0;\nlet agora = Date.now();\nlet delay_minimo = 1000; // 1 segundo entre chamadas\n\nif (agora - ultima_chamada &lt; delay_minimo) {\n    let esperar = delay_minimo - (agora - ultima_chamada);\n    node.warn(`Rate limit: aguardar ${esperar}ms`);\n\n    // Agendar retry\n    setTimeout(() =&gt; {\n        node.send(msg);\n    }, esperar);\n\n    return null;\n}\n\nflow.set('api_ultima_chamada', agora);\nreturn msg;\n</code></pre>"},{"location":"api-integracao/#variaveis-de-ambiente","title":"Vari\u00e1veis de Ambiente","text":"<p>Configurar credenciais da API:</p> <p>Ficheiro: <code>settings.js</code> (Node-RED)</p> <pre><code>functionGlobalContext: {\n    API_BASE_URL: process.env.API_BASE_URL || 'https://api.empresa.com',\n    API_TOKEN: process.env.API_TOKEN || '',\n}\n</code></pre> <p>Uso no flow: <pre><code>let api_url = global.get('API_BASE_URL');\nlet token = global.get('API_TOKEN');\n\nmsg.url = `${api_url}/produtos/${msg.codigo_produto}/preco`;\nmsg.headers = {\n    'Authorization': `Bearer ${token}`\n};\n\nreturn msg;\n</code></pre></p>"},{"location":"api-integracao/#exemplo-de-flow-json","title":"Exemplo de Flow JSON","text":"<pre><code>[\n    {\n        \"id\": \"api_flow_start\",\n        \"type\": \"mqtt in\",\n        \"topic\": \"linha_producao/estacao/+\",\n        \"broker\": \"mqtt_broker\",\n        \"wires\": [[\"extrair_codigo\"]]\n    },\n    {\n        \"id\": \"extrair_codigo\",\n        \"type\": \"function\",\n        \"name\": \"Extrair C\u00f3digo\",\n        \"func\": \"msg.codigo_produto = msg.payload.codigo_produto;\\nflow.set('ultimo_payload', msg.payload);\\nreturn msg;\",\n        \"wires\": [[\"http_get_preco\"]]\n    },\n    {\n        \"id\": \"http_get_preco\",\n        \"type\": \"http request\",\n        \"method\": \"GET\",\n        \"url\": \"https://api.empresa.com/produtos/{{codigo_produto}}/preco\",\n        \"wires\": [[\"calcular_valor\"]]\n    },\n    {\n        \"id\": \"calcular_valor\",\n        \"type\": \"function\",\n        \"name\": \"Calcular Valor\",\n        \"func\": \"// c\u00f3digo da fun\u00e7\u00e3o anterior\",\n        \"wires\": [[\"sqlite_insert\"]]\n    },\n    {\n        \"id\": \"sqlite_insert\",\n        \"type\": \"sqlite\",\n        \"db\": \"industrial_monitoring.db\",\n        \"wires\": [[]]\n    }\n]\n</code></pre>"},{"location":"api-integracao/#metricas-disponiveis","title":"M\u00e9tricas Dispon\u00edveis","text":"<p>Ap\u00f3s implementa\u00e7\u00e3o completa, ter\u00e1s acesso a:</p> <ol> <li>Valor de Produ\u00e7\u00e3o por Esta\u00e7\u00e3o (\u20ac/dia)</li> <li>Custo de Defeitos (\u20ac perdidos)</li> <li>ROI de Manuten\u00e7\u00f5es (comparar antes/depois)</li> <li>Produtos Mais Lucrativos</li> <li>Tend\u00eancias de Margem</li> </ol> <p>Estas m\u00e9tricas podem ser visualizadas no dashboard ou inclu\u00eddas nos relat\u00f3rios autom\u00e1ticos.</p>"},{"location":"api-integracao/#troubleshooting","title":"Troubleshooting","text":"<p>API retorna erro 401: - Verificar token de autentica\u00e7\u00e3o - Confirmar validade do token - Verificar headers da request</p> <p>Valores sempre zero: - Verificar se API est\u00e1 retornando dados - Debug do node HTTP request - Confirmar parsing JSON correto</p> <p>Performance lenta: - Implementar cache de pre\u00e7os - Reduzir frequ\u00eancia de chamadas - Considerar batch requests se API suportar</p>"},{"location":"api-integracao/#melhorias-futuras","title":"Melhorias Futuras","text":"<ul> <li>Webhook quando pre\u00e7os mudam (em vez de polling)</li> <li>Batch requests para m\u00faltiplos produtos</li> <li>Fallback para m\u00faltiplas APIs (redund\u00e2ncia)</li> <li>Machine learning para prever pre\u00e7os</li> </ul> <p>Esta integra\u00e7\u00e3o transforma dados operacionais em m\u00e9tricas financeiras, permitindo decis\u00f5es de neg\u00f3cio baseadas em dados em tempo real.</p>"},{"location":"arquitetura/","title":"Arquitetura T\u00e9cnica do Projeto","text":"<p>A arquitetura do ProjetoISIv1 implementa um sistema distribu\u00eddo que suporta todo o ciclo de vida dos dados industriais: recolha, processamento, armazenamento e visualiza\u00e7\u00e3o.</p>"},{"location":"arquitetura/#visao-geral-da-arquitetura","title":"Vis\u00e3o Geral da Arquitetura","text":"<p>O sistema segue uma arquitetura orientada a eventos (Event-Driven Architecture) baseada no protocolo MQTT, permitindo comunica\u00e7\u00e3o ass\u00edncrona e em tempo real entre os componentes.</p>"},{"location":"arquitetura/#principios-arquiteturais","title":"Princ\u00edpios Arquiteturais","text":"<ul> <li>Desacoplamento: Componentes comunicam atrav\u00e9s de mensagens MQTT</li> <li>Escalabilidade: Arquitetura permite adicionar novos sensores sem altera\u00e7\u00f5es</li> <li>Modularidade: Cada componente tem responsabilidades bem definidas</li> <li>Persist\u00eancia: Dados armazenados de forma estruturada e audit\u00e1vel</li> <li>Extensibilidade: F\u00e1cil integra\u00e7\u00e3o com novos sistemas e APIs</li> </ul>"},{"location":"arquitetura/#componentes-do-sistema","title":"Componentes do Sistema","text":""},{"location":"arquitetura/#1-camada-de-recolha-de-dados","title":"1. Camada de Recolha de Dados","text":""},{"location":"arquitetura/#11-publisher-simulador-mqtt-python","title":"1.1 Publisher - Simulador MQTT (Python)","text":"<p>Responsabilidade: Simular sensores IoT em ambiente industrial</p> <p>Funcionalidades:</p> <ul> <li>Gera\u00e7\u00e3o de dados sint\u00e9ticos de produ\u00e7\u00e3o, stock, paragens e defeitos</li> <li>Publica\u00e7\u00e3o de mensagens JSON em t\u00f3picos MQTT espec\u00edficos por esta\u00e7\u00e3o</li> <li>Configura\u00e7\u00e3o flex\u00edvel atrav\u00e9s de ficheiros JSON</li> <li>Suporte para m\u00faltiplos dispositivos e cen\u00e1rios de simula\u00e7\u00e3o</li> </ul> <p>Tecnologias: Python 3.10+, biblioteca <code>paho-mqtt</code></p> <p>T\u00f3picos MQTT: <pre><code>fabrica/estacao/{id}/producao\nfabrica/estacao/{id}/stock\nfabrica/estacao/{id}/paragem\nfabrica/estacao/{id}/defeitos\n</code></pre></p>"},{"location":"arquitetura/#12-integracao-azure-iot-fase-2","title":"1.2 Integra\u00e7\u00e3o Azure IoT (Fase 2)","text":"<p>Funcionalidades:</p> <ul> <li>Conex\u00e3o com Azure IoT Hub</li> <li>Envio de telemetria para a cloud</li> <li>Sincroniza\u00e7\u00e3o device-to-cloud</li> </ul>"},{"location":"arquitetura/#2-camada-de-mensagens","title":"2. Camada de Mensagens","text":""},{"location":"arquitetura/#21-broker-mqtt-eclipse-mosquitto","title":"2.1 Broker MQTT - Eclipse Mosquitto","text":"<p>Responsabilidade: Intermedi\u00e1rio de mensagens entre publishers e subscribers</p> <p>Caracter\u00edsticas:</p> <ul> <li>Protocolo MQTT v3.1.1 / v5.0</li> <li>Porta padr\u00e3o: <code>1883</code> (n\u00e3o encriptado) / <code>8883</code> (TLS)</li> <li>Suporte para QoS (Quality of Service) n\u00edveis 0, 1 e 2</li> <li>Persist\u00eancia de mensagens opcional</li> </ul> <p>Configura\u00e7\u00e3o: <pre><code>listener 1883\nallow_anonymous true\npersistence true\npersistence_location /var/lib/mosquitto/\n</code></pre></p>"},{"location":"arquitetura/#3-camada-de-processamento-etl","title":"3. Camada de Processamento (ETL)","text":""},{"location":"arquitetura/#31-node-red-motor-etl","title":"3.1 Node-RED - Motor ETL","text":"<p>Responsabilidade: Orquestra\u00e7\u00e3o de fluxos de dados e transforma\u00e7\u00f5es</p> <p>Pipeline de Processamento:</p> <ol> <li>Extract (Extra\u00e7\u00e3o)</li> <li>Subscri\u00e7\u00e3o a t\u00f3picos MQTT</li> <li>Rece\u00e7\u00e3o de payloads JSON</li> <li> <p>Parsing e valida\u00e7\u00e3o de dados</p> </li> <li> <p>Transform (Transforma\u00e7\u00e3o)</p> </li> <li>Normaliza\u00e7\u00e3o de valores</li> <li>C\u00e1lculo de acumulados e agrega\u00e7\u00f5es</li> <li>Filtragem de outliers</li> <li>Aplica\u00e7\u00e3o de regras de neg\u00f3cio</li> <li> <p>Enriquecimento com dados da API</p> </li> <li> <p>Load (Carregamento)</p> </li> <li>Inser\u00e7\u00e3o em SQLite3</li> <li>Atualiza\u00e7\u00e3o de registos existentes</li> <li>Trigger de jobs de relat\u00f3rio</li> </ol> <p>N\u00f3s Principais:</p> <ul> <li><code>mqtt in</code>: Rece\u00e7\u00e3o de mensagens</li> <li><code>function</code>: L\u00f3gica JavaScript para transforma\u00e7\u00f5es</li> <li><code>sqlite</code>: Opera\u00e7\u00f5es de base de dados</li> <li><code>exec</code>: Execu\u00e7\u00e3o de scripts Python</li> <li><code>email</code>: Envio de relat\u00f3rios</li> </ul>"},{"location":"arquitetura/#4-camada-de-persistencia","title":"4. Camada de Persist\u00eancia","text":""},{"location":"arquitetura/#41-base-de-dados-sqlite3","title":"4.1 Base de Dados SQLite3","text":"<p>Responsabilidade: Armazenamento estruturado de dados processados</p> <p>Estrutura de Tabelas:</p> <pre><code>-- Tabela de Esta\u00e7\u00f5es\nCREATE TABLE estacoes (\n    id INTEGER PRIMARY KEY,\n    nome TEXT NOT NULL,\n    localizacao TEXT,\n    tipo_producao TEXT\n);\n\n-- Tabela de Dados Acumulados\nCREATE TABLE dados_acumulados (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    estacao_id INTEGER,\n    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n    producao_total INTEGER,\n    stock_atual INTEGER,\n    tempo_paragem_segundos INTEGER,\n    defeitos_total INTEGER,\n    FOREIGN KEY (estacao_id) REFERENCES estacoes(id)\n);\n\n-- Tabela de Produtos\nCREATE TABLE produtos (\n    id INTEGER PRIMARY KEY,\n    nome TEXT NOT NULL,\n    preco_unitario REAL,\n    categoria TEXT\n);\n\n-- Tabela de Relat\u00f3rios\nCREATE TABLE relatorios (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    data_geracao DATETIME DEFAULT CURRENT_TIMESTAMP,\n    tipo TEXT,\n    conteudo TEXT,\n    enviado BOOLEAN DEFAULT 0\n);\n</code></pre> <p>Caracter\u00edsticas:</p> <ul> <li>Transa\u00e7\u00f5es ACID</li> <li>\u00cdndices para otimiza\u00e7\u00e3o de queries</li> <li>Triggers para auditoria autom\u00e1tica</li> </ul>"},{"location":"arquitetura/#5-camada-de-integracao","title":"5. Camada de Integra\u00e7\u00e3o","text":""},{"location":"arquitetura/#51-api-externa-precos-de-produtos","title":"5.1 API Externa - Pre\u00e7os de Produtos","text":"<p>Responsabilidade: Enriquecimento de dados com informa\u00e7\u00e3o externa</p> <p>Funcionalidades:</p> <ul> <li>Obten\u00e7\u00e3o de pre\u00e7os unit\u00e1rios de pe\u00e7as/produtos</li> <li>C\u00e1lculo de margens e custos de produ\u00e7\u00e3o</li> <li>Cruzamento com dados de produ\u00e7\u00e3o</li> <li>Utiliza\u00e7\u00e3o de regex para matching de produtos</li> </ul> <p>Fluxo de Integra\u00e7\u00e3o:</p> <ol> <li>Node-RED deteta nova produ\u00e7\u00e3o</li> <li>Extrai nome/c\u00f3digo do produto via regex</li> <li>Consulta API para obter pre\u00e7o</li> <li>Calcula valor total da produ\u00e7\u00e3o</li> <li>Armazena dados enriquecidos</li> </ol>"},{"location":"arquitetura/#6-camada-de-relatorios","title":"6. Camada de Relat\u00f3rios","text":""},{"location":"arquitetura/#61-python-reporting-engine","title":"6.1 Python Reporting Engine","text":"<p>Responsabilidade: Gera\u00e7\u00e3o e envio de relat\u00f3rios autom\u00e1ticos</p> <p>Funcionalidades:</p> <ul> <li>Consulta de dados agregados da base de dados</li> <li>Gera\u00e7\u00e3o de relat\u00f3rios em formato HTML/PDF</li> <li>C\u00e1lculo de KPIs: OEE, produtividade, tempo m\u00e9dio de paragem</li> <li>Envio autom\u00e1tico por email via SMTP</li> </ul> <p>Bibliotecas Utilizadas:</p> <ul> <li><code>sqlite3</code>: Conex\u00e3o \u00e0 base de dados</li> <li><code>smtplib</code>: Envio de emails</li> <li><code>jinja2</code>: Templates de relat\u00f3rios (opcional)</li> <li><code>matplotlib</code>: Gr\u00e1ficos e visualiza\u00e7\u00f5es (opcional)</li> </ul>"},{"location":"arquitetura/#7-camada-de-apresentacao","title":"7. Camada de Apresenta\u00e7\u00e3o","text":""},{"location":"arquitetura/#71-dashboard-web-react-material-ui","title":"7.1 Dashboard Web (React + Material-UI)","text":"<p>Responsabilidade: Visualiza\u00e7\u00e3o interativa de dados em tempo real</p> <p>Funcionalidades:</p> <ul> <li>Monitoriza\u00e7\u00e3o em tempo real de esta\u00e7\u00f5es de produ\u00e7\u00e3o</li> <li>Gr\u00e1ficos de produ\u00e7\u00e3o, paragens e efici\u00eancia</li> <li>Indicadores de performance (KPIs)</li> <li>Hist\u00f3rico de produ\u00e7\u00e3o e tend\u00eancias</li> <li>Interface responsiva e moderna</li> </ul> <p>Tecnologias:</p> <ul> <li>React 18+</li> <li>Material-UI v5</li> <li>Axios para chamadas API</li> <li>Chart.js / Recharts para gr\u00e1ficos</li> </ul>"},{"location":"arquitetura/#72-grafana-opcional","title":"7.2 Grafana (Opcional)","text":"<p>Funcionalidades:</p> <ul> <li>Dashboards configur\u00e1veis</li> <li>Alertas personalizados</li> <li>Visualiza\u00e7\u00f5es avan\u00e7adas</li> </ul>"},{"location":"arquitetura/#8-api-rest-gestao-de-simulacoes-fase-2","title":"8. API REST - Gest\u00e3o de Simula\u00e7\u00f5es (Fase 2)","text":"<p>Responsabilidade: Orquestra\u00e7\u00e3o de simuladores via API</p> <p>Endpoints: <pre><code>POST   /simulations              # Criar nova simula\u00e7\u00e3o\nGET    /simulations              # Listar simula\u00e7\u00f5es\nGET    /simulations/{id}         # Detalhes de simula\u00e7\u00e3o\nDELETE /simulations/{id}         # Parar simula\u00e7\u00e3o\nGET    /simulations/{id}/logs    # Logs de simula\u00e7\u00e3o\n</code></pre></p> <p>Funcionalidades:</p> <ul> <li>Gest\u00e3o de simuladores em containers Docker</li> <li>Configura\u00e7\u00e3o din\u00e2mica de sensores</li> <li>Monitoriza\u00e7\u00e3o de estado</li> <li>Persist\u00eancia em SQLite</li> </ul> <p>Tecnologia: FastAPI + Uvicorn</p>"},{"location":"arquitetura/#fluxo-global-de-dados","title":"Fluxo Global de Dados","text":"<pre><code>graph TB\n    subgraph \"Camada de Recolha\"\n        A[Simulador IoT Python]\n        A2[Azure IoT Device]\n    end\n\n    subgraph \"Camada de Mensagens\"\n        B[Broker MQTT Mosquitto]\n    end\n\n    subgraph \"Camada de Processamento\"\n        C[Node-RED ETL]\n    end\n\n    subgraph \"Camada de Persist\u00eancia\"\n        D[SQLite3]\n    end\n\n    subgraph \"Camada de Integra\u00e7\u00e3o\"\n        E[API Pre\u00e7os]\n    end\n\n    subgraph \"Camada de Relat\u00f3rios\"\n        F[Python Reports]\n        G[SMTP Email]\n    end\n\n    subgraph \"Camada de Apresenta\u00e7\u00e3o\"\n        H[Dashboard React]\n        I[Grafana]\n    end\n\n    A --&gt;|Publish| B\n    A2 --&gt;|Publish| B\n    B --&gt;|Subscribe| C\n    C --&gt;|Insert/Update| D\n    C -.-&gt;|Request| E\n    E -.-&gt;|Response| C\n    D --&gt;|Query| F\n    F --&gt;|Send| G\n    D --&gt;|API/Query| H\n    D -.-&gt;|Data Source| I\n</code></pre>"},{"location":"arquitetura/#padroes-arquiteturais-implementados","title":"Padr\u00f5es Arquiteturais Implementados","text":""},{"location":"arquitetura/#1-publish-subscribe-pattern","title":"1. Publish-Subscribe Pattern","text":"<ul> <li>Desacoplamento entre produtores e consumidores de dados</li> <li>Comunica\u00e7\u00e3o ass\u00edncrona via MQTT</li> </ul>"},{"location":"arquitetura/#2-etl-pipeline-pattern","title":"2. ETL Pipeline Pattern","text":"<ul> <li>Separa\u00e7\u00e3o clara entre extra\u00e7\u00e3o, transforma\u00e7\u00e3o e carregamento</li> <li>Processamento sequencial com valida\u00e7\u00e3o em cada etapa</li> </ul>"},{"location":"arquitetura/#3-repository-pattern","title":"3. Repository Pattern","text":"<ul> <li>Abstra\u00e7\u00e3o de acesso a dados via SQLite</li> <li>Centraliza\u00e7\u00e3o de queries e l\u00f3gica de persist\u00eancia</li> </ul>"},{"location":"arquitetura/#caracteristicas-nao-funcionais","title":"Caracter\u00edsticas N\u00e3o-Funcionais","text":""},{"location":"arquitetura/#performance","title":"Performance","text":"<ul> <li>Processamento em tempo real com lat\u00eancia &lt; 100ms</li> <li>Suporte para 100+ mensagens/segundo</li> </ul>"},{"location":"arquitetura/#escalabilidade","title":"Escalabilidade","text":"<ul> <li>Arquitetura horizontal para m\u00faltiplas esta\u00e7\u00f5es</li> <li>Possibilidade de federa\u00e7\u00e3o de brokers MQTT</li> </ul>"},{"location":"arquitetura/#disponibilidade","title":"Disponibilidade","text":"<ul> <li>Persist\u00eancia de mensagens no broker</li> <li>Reconex\u00e3o autom\u00e1tica de clientes</li> </ul>"},{"location":"arquitetura/#seguranca","title":"Seguran\u00e7a","text":"<ul> <li>Autentica\u00e7\u00e3o MQTT (futuro)</li> <li>Encripta\u00e7\u00e3o TLS para comunica\u00e7\u00f5es (futuro)</li> <li>Valida\u00e7\u00e3o de inputs em todas as camadas</li> </ul>"},{"location":"arquitetura/#manutenibilidade","title":"Manutenibilidade","text":"<ul> <li>C\u00f3digo modular e documentado</li> <li>Configura\u00e7\u00e3o externa (JSON/YAML)</li> <li>Logs estruturados</li> </ul>"},{"location":"arquitetura/#tecnologias-utilizadas","title":"Tecnologias Utilizadas","text":"Componente Tecnologia Vers\u00e3o Licen\u00e7a Simulador IoT Python 3.10+ PSF Broker MQTT Mosquitto 2.0+ EPL/EDL Motor ETL Node-RED 3.0+ Apache 2.0 Base de Dados SQLite 3.40+ Public Domain Frontend React 18+ MIT UI Components Material-UI 5+ MIT API Framework FastAPI 0.100+ MIT Documenta\u00e7\u00e3o MkDocs 1.5+ BSD"},{"location":"arquitetura/#proximos-passos","title":"Pr\u00f3ximos Passos","text":"<p>Ver Fase 2 - Roadmap para melhorias planeadas:</p> <ul> <li>Migra\u00e7\u00e3o para SQL Server</li> <li>Containeriza\u00e7\u00e3o completa com Docker Compose</li> <li>Implementa\u00e7\u00e3o de Machine Learning para predi\u00e7\u00f5es</li> <li>Sistema de alertas em tempo real (SMS/Telegram)</li> </ul>"},{"location":"azure-iot-integracao/","title":"Integra\u00e7\u00e3o Azure IoT Hub","text":"<p>Sistema de envio de telemetria para a cloud usando Azure IoT Hub, permitindo monitoriza\u00e7\u00e3o centralizada e an\u00e1lise de dados em escala.</p>"},{"location":"azure-iot-integracao/#visao-geral","title":"Vis\u00e3o Geral","text":"<p>Objetivo: Conectar sensores IoT simulados ao Azure IoT Hub para processamento na cloud.</p> <p>Biblioteca: <code>azure-iot-device</code> (Python SDK oficial da Microsoft)</p> <p>Arquitetura Dual: <pre><code>Simulador IoT\n     \u251c\u2500\u2500&gt; MQTT Local (Mosquitto) \u2192 Node-RED \u2192 Dashboard/DB Local\n     \u2514\u2500\u2500&gt; Azure IoT Hub \u2192 Stream Analytics \u2192 Azure SQL/Storage\n</code></pre></p> <p>Casos de Uso: - Monitoriza\u00e7\u00e3o multi-site centralizada - Backup de dados na cloud - An\u00e1lise com Azure Stream Analytics - Dashboards em Azure IoT Central - Integra\u00e7\u00e3o com Power BI</p>"},{"location":"azure-iot-integracao/#instalacao","title":"Instala\u00e7\u00e3o","text":"<pre><code>pip install azure-iot-device\n</code></pre> <p>Depend\u00eancias: <pre><code>azure-iot-device==2.13.0\npaho-mqtt==1.6.1\n</code></pre></p>"},{"location":"azure-iot-integracao/#configuracao-azure-iot-hub","title":"Configura\u00e7\u00e3o Azure IoT Hub","text":""},{"location":"azure-iot-integracao/#1-criar-iot-hub-azure-portal","title":"1. Criar IoT Hub (Azure Portal)","text":"<ol> <li>Aceder ao Azure Portal</li> <li>Criar recurso \u2192 Internet of Things \u2192 IoT Hub</li> <li>Configurar:</li> <li>Nome: <code>producao-industrial-hub</code></li> <li>Regi\u00e3o: West Europe</li> <li>Tier: F1 (gratuito) ou S1 (produ\u00e7\u00e3o)</li> <li>Criar</li> </ol>"},{"location":"azure-iot-integracao/#2-registar-device","title":"2. Registar Device","text":"<p>Via Portal: 1. IoT Hub \u2192 Devices \u2192 Add Device 2. Device ID: <code>estacao-1</code> 3. Authentication: Symmetric Key (auto-generate) 4. Copiar Primary Connection String</p> <p>Via Azure CLI: <pre><code>az iot hub device-identity create \\\n  --hub-name producao-industrial-hub \\\n  --device-id estacao-1\n\naz iot hub device-identity connection-string show \\\n  --hub-name producao-industrial-hub \\\n  --device-id estacao-1\n</code></pre></p> <p>Connection String (guardar de forma segura): <pre><code>HostName=producao-industrial-hub.azure-devices.net;DeviceId=estacao-1;SharedAccessKey=xxxxxxxxxxxx\n</code></pre></p>"},{"location":"azure-iot-integracao/#implementacao-python","title":"Implementa\u00e7\u00e3o Python","text":""},{"location":"azure-iot-integracao/#exemplo-basico-enviar-telemetria","title":"Exemplo B\u00e1sico: Enviar Telemetria","text":"<pre><code># azure_iot_sender.py\n\nfrom azure.iot.device import IoTHubDeviceClient, Message\nimport json\nimport time\nfrom datetime import datetime\nimport os\n\nclass AzureIoTSender:\n    def __init__(self, connection_string):\n        \"\"\"\n        Inicializar cliente Azure IoT\n\n        Args:\n            connection_string: Connection string do device no Azure IoT Hub\n        \"\"\"\n        self.client = IoTHubDeviceClient.create_from_connection_string(\n            connection_string\n        )\n        self.connected = False\n\n    def connect(self):\n        \"\"\"Conectar ao Azure IoT Hub\"\"\"\n        try:\n            self.client.connect()\n            self.connected = True\n            print(f\"\u2713 Conectado ao Azure IoT Hub\")\n        except Exception as e:\n            print(f\"\u2717 Erro ao conectar: {e}\")\n            self.connected = False\n\n    def send_telemetry(self, data):\n        \"\"\"\n        Enviar telemetria para Azure IoT Hub\n\n        Args:\n            data: Dicion\u00e1rio com dados do sensor\n        \"\"\"\n        if not self.connected:\n            print(\"\u2717 N\u00e3o conectado ao Azure IoT Hub\")\n            return False\n\n        try:\n            # Adicionar timestamp se n\u00e3o existir\n            if 'timestamp' not in data:\n                data['timestamp'] = datetime.now().isoformat()\n\n            # Criar mensagem\n            message = Message(json.dumps(data))\n\n            # Definir propriedades da mensagem\n            message.content_type = \"application/json\"\n            message.content_encoding = \"utf-8\"\n\n            # Adicionar propriedades customizadas\n            message.custom_properties[\"estacao_id\"] = str(data.get(\"estacao\", \"unknown\"))\n            message.custom_properties[\"tipo_alerta\"] = self._check_alert(data)\n\n            # Enviar\n            self.client.send_message(message)\n            print(f\"\u2713 Telemetria enviada: Esta\u00e7\u00e3o {data.get('estacao')}\")\n\n            return True\n\n        except Exception as e:\n            print(f\"\u2717 Erro ao enviar telemetria: {e}\")\n            return False\n\n    def _check_alert(self, data):\n        \"\"\"Verificar se h\u00e1 condi\u00e7\u00f5es de alerta\"\"\"\n        dados = data.get('dados', {})\n\n        if dados.get('defeitos', 0) &gt; 10:\n            return \"defeitos_alto\"\n        elif dados.get('paragem', 0) &gt; 600:  # 10 min\n            return \"paragem_longa\"\n        elif dados.get('stock', 0) &lt; 20:\n            return \"stock_baixo\"\n\n        return \"normal\"\n\n    def disconnect(self):\n        \"\"\"Desconectar do Azure IoT Hub\"\"\"\n        if self.connected:\n            self.client.disconnect()\n            self.connected = False\n            print(\"\u2713 Desconectado do Azure IoT Hub\")\n\n\n# Exemplo de uso\nif __name__ == \"__main__\":\n    # Connection string do device (usar vari\u00e1vel de ambiente)\n    CONN_STRING = os.getenv('AZURE_IOT_CONNECTION_STRING')\n\n    if not CONN_STRING:\n        print(\"Erro: Definir AZURE_IOT_CONNECTION_STRING\")\n        exit(1)\n\n    # Criar cliente\n    azure_sender = AzureIoTSender(CONN_STRING)\n    azure_sender.connect()\n\n    # Enviar dados de exemplo\n    dados_exemplo = {\n        \"estacao\": 1,\n        \"dados\": {\n            \"producao\": 458,\n            \"stock\": 120,\n            \"paragem\": 180,\n            \"defeitos\": 5\n        }\n    }\n\n    azure_sender.send_telemetry(dados_exemplo)\n\n    # Desconectar\n    azure_sender.disconnect()\n</code></pre>"},{"location":"azure-iot-integracao/#integracao-com-simulador-mqtt-existente","title":"Integra\u00e7\u00e3o com Simulador MQTT Existente","text":""},{"location":"azure-iot-integracao/#simulador-dual-mqtt-local-azure-iot","title":"Simulador Dual: MQTT Local + Azure IoT","text":"<pre><code># mqtt_publisher_azure.py\n\nimport paho.mqtt.client as mqtt\nfrom azure.iot.device import IoTHubDeviceClient, Message\nimport json\nimport time\nimport random\nfrom datetime import datetime\nimport os\n\nclass DualPublisher:\n    \"\"\"Publica para MQTT local E Azure IoT Hub simultaneamente\"\"\"\n\n    def __init__(self, mqtt_broker, mqtt_port, azure_conn_string, estacao_id):\n        # MQTT Local\n        self.mqtt_client = mqtt.Client()\n        self.mqtt_broker = mqtt_broker\n        self.mqtt_port = mqtt_port\n\n        # Azure IoT\n        self.azure_client = IoTHubDeviceClient.create_from_connection_string(\n            azure_conn_string\n        )\n\n        self.estacao_id = estacao_id\n        self.running = False\n\n    def connect(self):\n        \"\"\"Conectar a ambos os endpoints\"\"\"\n        # Conectar MQTT local\n        try:\n            self.mqtt_client.connect(self.mqtt_broker, self.mqtt_port, 60)\n            self.mqtt_client.loop_start()\n            print(f\"\u2713 Conectado ao MQTT local ({self.mqtt_broker}:{self.mqtt_port})\")\n        except Exception as e:\n            print(f\"\u2717 Erro MQTT local: {e}\")\n\n        # Conectar Azure IoT\n        try:\n            self.azure_client.connect()\n            print(f\"\u2713 Conectado ao Azure IoT Hub\")\n        except Exception as e:\n            print(f\"\u2717 Erro Azure IoT: {e}\")\n\n    def publish_data(self, data):\n        \"\"\"Publicar dados para ambos os destinos\"\"\"\n        timestamp = datetime.now().isoformat()\n\n        payload = {\n            \"estacao\": self.estacao_id,\n            \"timestamp\": timestamp,\n            \"dados\": data\n        }\n\n        # Publicar no MQTT local\n        try:\n            topic = f\"linha_producao/estacao/{self.estacao_id}\"\n            self.mqtt_client.publish(topic, json.dumps(data), qos=2)\n            print(f\"\u2192 MQTT: {topic}\")\n        except Exception as e:\n            print(f\"\u2717 Erro MQTT publish: {e}\")\n\n        # Publicar no Azure IoT Hub\n        try:\n            message = Message(json.dumps(payload))\n            message.content_type = \"application/json\"\n            message.content_encoding = \"utf-8\"\n            message.custom_properties[\"estacao_id\"] = str(self.estacao_id)\n\n            self.azure_client.send_message(message)\n            print(f\"\u2192 Azure: Esta\u00e7\u00e3o {self.estacao_id}\")\n        except Exception as e:\n            print(f\"\u2717 Erro Azure publish: {e}\")\n\n    def simulate_production(self, interval=60):\n        \"\"\"Simular produ\u00e7\u00e3o continuamente\"\"\"\n        self.running = True\n\n        print(f\"\\n\u25b6 Iniciando simula\u00e7\u00e3o (Esta\u00e7\u00e3o {self.estacao_id})\")\n        print(f\"Intervalo: {interval}s | Ctrl+C para parar\\n\")\n\n        try:\n            while self.running:\n                # Gerar dados sint\u00e9ticos\n                data = {\n                    \"producao\": random.randint(80, 120),\n                    \"stock\": random.randint(50, 200),\n                    \"paragem\": random.randint(0, 300),\n                    \"defeitos\": random.randint(0, 8)\n                }\n\n                # Publicar\n                self.publish_data(data)\n\n                # Aguardar\n                time.sleep(interval)\n\n        except KeyboardInterrupt:\n            print(\"\\n\u25a0 Simula\u00e7\u00e3o interrompida\")\n            self.running = False\n\n    def disconnect(self):\n        \"\"\"Desconectar de ambos\"\"\"\n        self.running = False\n\n        try:\n            self.mqtt_client.loop_stop()\n            self.mqtt_client.disconnect()\n            print(\"\u2713 MQTT local desconectado\")\n        except:\n            pass\n\n        try:\n            self.azure_client.disconnect()\n            print(\"\u2713 Azure IoT desconectado\")\n        except:\n            pass\n\n\n# Executar\nif __name__ == \"__main__\":\n    # Configura\u00e7\u00e3o\n    MQTT_BROKER = os.getenv('MQTT_BROKER', 'localhost')\n    MQTT_PORT = int(os.getenv('MQTT_PORT', 1883))\n    AZURE_CONN = os.getenv('AZURE_IOT_CONNECTION_STRING')\n    ESTACAO_ID = int(os.getenv('ESTACAO_ID', 1))\n\n    if not AZURE_CONN:\n        print(\"Erro: Definir AZURE_IOT_CONNECTION_STRING\")\n        exit(1)\n\n    # Criar publisher dual\n    publisher = DualPublisher(MQTT_BROKER, MQTT_PORT, AZURE_CONN, ESTACAO_ID)\n\n    # Conectar\n    publisher.connect()\n\n    # Simular\n    try:\n        publisher.simulate_production(interval=60)\n    finally:\n        publisher.disconnect()\n</code></pre>"},{"location":"azure-iot-integracao/#variaveis-de-ambiente","title":"Vari\u00e1veis de Ambiente","text":"<pre><code># .env\nexport MQTT_BROKER=\"localhost\"\nexport MQTT_PORT=\"1883\"\nexport AZURE_IOT_CONNECTION_STRING=\"HostName=....azure-devices.net;DeviceId=estacao-1;SharedAccessKey=...\"\nexport ESTACAO_ID=\"1\"\n</code></pre>"},{"location":"azure-iot-integracao/#device-twin-propriedades-do-device","title":"Device Twin (Propriedades do Device)","text":""},{"location":"azure-iot-integracao/#ler-e-atualizar-propriedades","title":"Ler e Atualizar Propriedades","text":"<pre><code># device_twin_manager.py\n\nfrom azure.iot.device import IoTHubDeviceClient\nimport json\n\nclass DeviceTwinManager:\n    def __init__(self, connection_string):\n        self.client = IoTHubDeviceClient.create_from_connection_string(\n            connection_string\n        )\n        self.client.connect()\n\n    def get_desired_properties(self):\n        \"\"\"Obter configura\u00e7\u00f5es enviadas pela cloud\"\"\"\n        twin = self.client.get_twin()\n        desired = twin['desired']\n\n        print(\"Configura\u00e7\u00f5es desejadas (cloud \u2192 device):\")\n        print(json.dumps(desired, indent=2))\n\n        return desired\n\n    def update_reported_properties(self, properties):\n        \"\"\"Reportar estado do device para a cloud\"\"\"\n        self.client.patch_twin_reported_properties(properties)\n        print(f\"\u2713 Propriedades reportadas atualizadas: {properties}\")\n\n    def get_full_twin(self):\n        \"\"\"Obter twin completo\"\"\"\n        twin = self.client.get_twin()\n\n        print(\"\\nDevice Twin completo:\")\n        print(json.dumps(twin, indent=2))\n\n        return twin\n\n\n# Exemplo de uso\nif __name__ == \"__main__\":\n    import os\n\n    conn_string = os.getenv('AZURE_IOT_CONNECTION_STRING')\n    manager = DeviceTwinManager(conn_string)\n\n    # Ler configura\u00e7\u00f5es da cloud\n    desired = manager.get_desired_properties()\n\n    # Reportar estado atual do device\n    reported = {\n        \"firmware_version\": \"1.2.0\",\n        \"capacidade_maxima\": 500,\n        \"status\": \"operacional\",\n        \"ultima_manutencao\": \"2024-12-20\",\n        \"temperatura_sensor\": 42.5\n    }\n\n    manager.update_reported_properties(reported)\n\n    # Ver twin completo\n    manager.get_full_twin()\n</code></pre>"},{"location":"azure-iot-integracao/#configurar-via-azure-portal","title":"Configurar via Azure Portal","text":"<ol> <li>IoT Hub \u2192 Devices \u2192 estacao-1 \u2192 Device Twin</li> <li>Adicionar desired properties:</li> </ol> <pre><code>{\n  \"desired\": {\n    \"frequencia_envio\": 60,\n    \"modo_producao\": \"alta_velocidade\",\n    \"threshold_alerta_defeitos\": 10,\n    \"threshold_paragem\": 600\n  }\n}\n</code></pre> <ol> <li>No simulador, ler estas configs e ajustar comportamento:</li> </ol> <pre><code>desired = manager.get_desired_properties()\nfrequencia = desired.get('frequencia_envio', 60)\nthreshold_defeitos = desired.get('threshold_alerta_defeitos', 10)\n\n# Usar nas simula\u00e7\u00f5es\npublisher.simulate_production(interval=frequencia)\n</code></pre>"},{"location":"azure-iot-integracao/#direct-methods-comandos-remotos","title":"Direct Methods (Comandos Remotos)","text":""},{"location":"azure-iot-integracao/#executar-comandos-da-cloud","title":"Executar Comandos da Cloud","text":"<pre><code># direct_methods_handler.py\n\nfrom azure.iot.device import IoTHubDeviceClient, MethodResponse\nimport json\nimport time\n\nclass CommandHandler:\n    def __init__(self, connection_string):\n        self.client = IoTHubDeviceClient.create_from_connection_string(\n            connection_string\n        )\n        self.producao_ativa = True\n        self.frequencia = 60\n\n        # Registar handler de m\u00e9todos\n        self.client.on_method_request_received = self.method_request_handler\n\n    def method_request_handler(self, method_request):\n        \"\"\"Handler para processar comandos da cloud\"\"\"\n        print(f\"\\n\ud83d\udce5 Comando recebido: {method_request.name}\")\n        print(f\"Payload: {method_request.payload}\")\n\n        # Processar comando\n        if method_request.name == \"parar_producao\":\n            response = self._parar_producao()\n\n        elif method_request.name == \"iniciar_producao\":\n            response = self._iniciar_producao()\n\n        elif method_request.name == \"ajustar_frequencia\":\n            frequencia = method_request.payload.get(\"frequencia\", 60)\n            response = self._ajustar_frequencia(frequencia)\n\n        elif method_request.name == \"obter_status\":\n            response = self._obter_status()\n\n        elif method_request.name == \"resetar_contadores\":\n            response = self._resetar_contadores()\n\n        else:\n            response = {\n                \"result\": f\"Comando desconhecido: {method_request.name}\",\n                \"status\": 404\n            }\n\n        # Enviar resposta\n        method_response = MethodResponse.create_from_method_request(\n            method_request,\n            status=response[\"status\"],\n            payload=response\n        )\n\n        self.client.send_method_response(method_response)\n        print(f\"\u2713 Resposta enviada: {response['result']}\\n\")\n\n    def _parar_producao(self):\n        self.producao_ativa = False\n        return {\n            \"result\": \"Produ\u00e7\u00e3o parada com sucesso\",\n            \"status\": 200,\n            \"producao_ativa\": False\n        }\n\n    def _iniciar_producao(self):\n        self.producao_ativa = True\n        return {\n            \"result\": \"Produ\u00e7\u00e3o iniciada com sucesso\",\n            \"status\": 200,\n            \"producao_ativa\": True\n        }\n\n    def _ajustar_frequencia(self, nova_freq):\n        self.frequencia = nova_freq\n        return {\n            \"result\": f\"Frequ\u00eancia ajustada para {nova_freq} segundos\",\n            \"status\": 200,\n            \"frequencia\": nova_freq\n        }\n\n    def _obter_status(self):\n        return {\n            \"result\": \"Status obtido\",\n            \"status\": 200,\n            \"producao_ativa\": self.producao_ativa,\n            \"frequencia\": self.frequencia,\n            \"timestamp\": time.time()\n        }\n\n    def _resetar_contadores(self):\n        # L\u00f3gica para resetar contadores\n        return {\n            \"result\": \"Contadores resetados\",\n            \"status\": 200\n        }\n\n    def start_listening(self):\n        \"\"\"Iniciar escuta de comandos\"\"\"\n        self.client.connect()\n        print(\"\u2713 Conectado ao Azure IoT Hub\")\n        print(\"\ud83d\udc42 Aguardando comandos da cloud...\\n\")\n\n        try:\n            while True:\n                time.sleep(1)\n        except KeyboardInterrupt:\n            print(\"\\n\u25a0 Parando escuta de comandos\")\n            self.client.disconnect()\n\n\n# Executar\nif __name__ == \"__main__\":\n    import os\n\n    conn_string = os.getenv('AZURE_IOT_CONNECTION_STRING')\n    handler = CommandHandler(conn_string)\n    handler.start_listening()\n</code></pre>"},{"location":"azure-iot-integracao/#invocar-comando-via-azure-cli","title":"Invocar Comando via Azure CLI","text":"<pre><code># Parar produ\u00e7\u00e3o\naz iot hub invoke-device-method \\\n  --hub-name producao-industrial-hub \\\n  --device-id estacao-1 \\\n  --method-name parar_producao\n\n# Ajustar frequ\u00eancia\naz iot hub invoke-device-method \\\n  --hub-name producao-industrial-hub \\\n  --device-id estacao-1 \\\n  --method-name ajustar_frequencia \\\n  --method-payload '{\"frequencia\": 30}'\n\n# Obter status\naz iot hub invoke-device-method \\\n  --hub-name producao-industrial-hub \\\n  --device-id estacao-1 \\\n  --method-name obter_status\n</code></pre>"},{"location":"azure-iot-integracao/#monitorizacao-de-mensagens","title":"Monitoriza\u00e7\u00e3o de Mensagens","text":""},{"location":"azure-iot-integracao/#ver-telemetria-em-tempo-real","title":"Ver Telemetria em Tempo Real","text":"<pre><code># Azure CLI - Monitorizar mensagens\naz iot hub monitor-events \\\n  --hub-name producao-industrial-hub \\\n  --device-id estacao-1\n\n# Ou para todos os devices\naz iot hub monitor-events \\\n  --hub-name producao-industrial-hub\n</code></pre>"},{"location":"azure-iot-integracao/#azure-iot-explorer-gui","title":"Azure IoT Explorer (GUI)","text":"<ol> <li>Instalar: Azure IoT Explorer</li> <li>Conectar ao IoT Hub</li> <li>Selecionar device</li> <li>Tab \"Telemetry\" \u2192 Start</li> <li>Visualizar mensagens em tempo real</li> </ol>"},{"location":"azure-iot-integracao/#processamento-na-cloud","title":"Processamento na Cloud","text":""},{"location":"azure-iot-integracao/#azure-stream-analytics","title":"Azure Stream Analytics","text":"<p>Input: Azure IoT Hub Output: Azure SQL Database / Blob Storage / Power BI</p> <p>Query SQL: <pre><code>-- Calcular m\u00e9dias por esta\u00e7\u00e3o (janela de 5 minutos)\nSELECT\n    estacao,\n    System.Timestamp() AS window_end,\n    AVG(dados.producao) AS producao_media,\n    AVG(dados.stock) AS stock_medio,\n    SUM(dados.defeitos) AS total_defeitos,\n    AVG(dados.paragem) AS paragem_media\nINTO\n    [output-sql]\nFROM\n    [input-iothub]\nTIMESTAMP BY timestamp\nGROUP BY\n    estacao,\n    TumblingWindow(minute, 5)\n\n-- Alertas de defeitos altos\nSELECT\n    estacao,\n    dados.defeitos AS defeitos,\n    timestamp\nINTO\n    [output-alerts]\nFROM\n    [input-iothub]\nWHERE\n    dados.defeitos &gt; 10\n</code></pre></p>"},{"location":"azure-iot-integracao/#armazenar-em-azure-sql","title":"Armazenar em Azure SQL","text":"<p>Tabela: <pre><code>CREATE TABLE TelemetriaProducao (\n    Id INT IDENTITY(1,1) PRIMARY KEY,\n    EstacaoId INT,\n    Timestamp DATETIME2,\n    Producao INT,\n    Stock INT,\n    Paragem INT,\n    Defeitos INT,\n    ReceivedAt DATETIME2 DEFAULT GETUTCDATE()\n);\n\nCREATE INDEX idx_estacao_timestamp \nON TelemetriaProducao(EstacaoId, Timestamp DESC);\n</code></pre></p>"},{"location":"azure-iot-integracao/#seguranca","title":"Seguran\u00e7a","text":""},{"location":"azure-iot-integracao/#boas-praticas","title":"Boas Pr\u00e1ticas","text":"<ol> <li>N\u00e3o hardcodar connection strings - Usar vari\u00e1veis de ambiente</li> <li>Rota\u00e7\u00e3o de chaves - Regenerar Shared Access Keys periodicamente</li> <li>Usar X.509 Certificates em produ\u00e7\u00e3o (em vez de Symmetric Keys)</li> <li>Implementar Device Provisioning Service (DPS) para escala</li> </ol>"},{"location":"azure-iot-integracao/#connection-string-em-variavel-de-ambiente","title":"Connection String em Vari\u00e1vel de Ambiente","text":"<pre><code>import os\nfrom dotenv import load_dotenv\n\nload_dotenv()  # Ler .env\n\nCONN_STRING = os.getenv('AZURE_IOT_CONNECTION_STRING')\n\nif not CONN_STRING:\n    raise ValueError(\"AZURE_IOT_CONNECTION_STRING n\u00e3o definida\")\n</code></pre> <p>.env (n\u00e3o commitar no Git): <pre><code>AZURE_IOT_CONNECTION_STRING=HostName=...\n</code></pre></p> <p>.gitignore: <pre><code>.env\n*.pyc\n</code></pre></p>"},{"location":"azure-iot-integracao/#casos-de-uso","title":"Casos de Uso","text":""},{"location":"azure-iot-integracao/#1-multi-site-monitoring","title":"1. Multi-Site Monitoring","text":"<p>Centralizar dados de m\u00faltiplas f\u00e1bricas: <pre><code>F\u00e1brica Lisboa \u2192 Azure IoT Hub\nF\u00e1brica Porto \u2192 Azure IoT Hub \u2192 An\u00e1lise \u2192 Dashboard Power BI\nF\u00e1brica Braga \u2192 Azure IoT Hub\n</code></pre></p>"},{"location":"azure-iot-integracao/#2-backup-na-cloud","title":"2. Backup na Cloud","text":"<ul> <li>Dados locais (SQLite) para opera\u00e7\u00e3o imediata</li> <li>Dados na cloud (Azure SQL) para hist\u00f3rico e an\u00e1lise</li> </ul>"},{"location":"azure-iot-integracao/#3-machine-learning","title":"3. Machine Learning","text":"<ul> <li>Azure Stream Analytics \u2192 Azure ML</li> <li>Prever falhas de equipamento</li> <li>Otimizar schedules de produ\u00e7\u00e3o</li> </ul>"},{"location":"azure-iot-integracao/#4-alertas-avancados","title":"4. Alertas Avan\u00e7ados","text":"<ul> <li>Logic Apps triggam emails/SMS em defeitos altos</li> <li>Integra\u00e7\u00e3o com Microsoft Teams</li> <li>Webhooks para sistemas externos</li> </ul>"},{"location":"azure-iot-integracao/#custos-azure-iot-hub","title":"Custos Azure IoT Hub","text":"Tier Mensagens/dia Pre\u00e7o/m\u00eas Casos de Uso F1 (Free) 8.000 \u20ac0 Desenvolvimento/Testes S1 (Standard) 400.000 ~\u20ac21 Produ\u00e7\u00e3o pequena S2 6M ~\u20ac630 Produ\u00e7\u00e3o m\u00e9dia S3 300M ~\u20ac6.300 Enterprise <p>C\u00e1lculo: - 3 esta\u00e7\u00f5es \u00d7 1 msg/min \u00d7 60 min \u00d7 24h = 4.320 msgs/dia - Cabe no F1 gratuito ou S1 com folga</p>"},{"location":"azure-iot-integracao/#troubleshooting","title":"Troubleshooting","text":"<p>Erro de autentica\u00e7\u00e3o: - Verificar connection string correta - Confirmar device est\u00e1 registado no IoT Hub - Regenerar chave se necess\u00e1rio</p> <p>Mensagens n\u00e3o chegam: - Verificar se device est\u00e1 conectado - Monitorizar com <code>az iot hub monitor-events</code> - Verificar quotas do tier F1 (8k msgs/dia)</p> <p>Timeout de conex\u00e3o: - Verificar firewall/proxy - Porta 8883 (MQTT) ou 443 (HTTPS) aberta - Testar conectividade: <code>telnet producao-industrial-hub.azure-devices.net 8883</code></p>"},{"location":"azure-iot-integracao/#proximos-passos","title":"Pr\u00f3ximos Passos","text":"<ol> <li>Implementar retry logic para reconex\u00f5es</li> <li>Batch messages para otimizar quotas</li> <li>Migrar para X.509 certificates (mais seguro)</li> <li>Implementar Device Provisioning Service para auto-registro</li> <li>Criar dashboards no Power BI conectados ao Azure SQL</li> </ol>"},{"location":"azure-iot-integracao/#recursos","title":"Recursos","text":"<ul> <li>Azure IoT Hub Docs</li> <li>Python SDK Reference</li> <li>Azure IoT Explorer</li> <li>Pricing Calculator</li> </ul> <p>Esta integra\u00e7\u00e3o adiciona capacidades enterprise ao ProjetoISIv1, permitindo escalar de um prot\u00f3tipo local para uma solu\u00e7\u00e3o cloud-ready com monitoriza\u00e7\u00e3o centralizada e an\u00e1lise avan\u00e7ada.</p>"},{"location":"base-de-dados/","title":"Base de Dados","text":"<p>O ProjetoISIv1 utiliza SQLite3 como sistema de gestao de base de dados para armazenar dados de monitorizacao industrial processados pelo sistema ETL.</p>"},{"location":"base-de-dados/#visao-geral","title":"Visao Geral","text":""},{"location":"base-de-dados/#tecnologia","title":"Tecnologia","text":"<p>SQLite 3.40+ - Base de dados relacional embutida, serverless e self-contained</p>"},{"location":"base-de-dados/#vantagens-da-escolha","title":"Vantagens da Escolha","text":"<ul> <li>Simplicidade: Nao requer servidor dedicado</li> <li>Portabilidade: Ficheiro unico <code>.db</code> facilmente transferivel</li> <li>Performance: Rapida para operacoes de leitura/escrita locais</li> <li>Zero Configuracao: Pronta a usar sem setup complexo</li> <li>ACID Compliant: Garante integridade transacional</li> <li>Adequada para Prototipos: Ideal para desenvolvimento e demonstracao</li> </ul>"},{"location":"base-de-dados/#limitacoes","title":"Limitacoes","text":"<ul> <li>Nao adequada para alta concorrencia (multiplas escritas simultaneas)</li> <li>Sem controlo de acessos granular</li> <li>Para producao enterprise, considerar migracao para SQL Server/PostgreSQL (ver Fase 2)</li> </ul>"},{"location":"base-de-dados/#estrutura-da-base-de-dados","title":"Estrutura da Base de Dados","text":""},{"location":"base-de-dados/#diagrama-entidade-relacionamento","title":"Diagrama Entidade-Relacionamento","text":""},{"location":"base-de-dados/#tabelas","title":"Tabelas","text":""},{"location":"base-de-dados/#1-estacoes","title":"1. estacoes","text":"<p>Armazena informacoes sobre as estacoes de producao monitorizadas.</p> <pre><code>CREATE TABLE estacoes (\n    id INTEGER PRIMARY KEY,\n    nome TEXT NOT NULL,\n    localizacao TEXT,\n    tipo_producao TEXT,\n    capacidade_maxima INTEGER,\n    status TEXT DEFAULT 'ativa',\n    data_instalacao DATE,\n    ultima_manutencao DATE\n);\n</code></pre>"},{"location":"base-de-dados/#campos-estacoes","title":"Campos (estacoes)","text":"Campo Tipo Descricao <code>id</code> INTEGER (PK) Identificador unico da estacao <code>nome</code> TEXT (NOT NULL) Nome descritivo da estacao <code>localizacao</code> TEXT Localizacao fisica (ex: \"Nave A - Setor 2\") <code>tipo_producao</code> TEXT Tipo de produto fabricado <code>capacidade_maxima</code> INTEGER Capacidade maxima de producao (pecas/hora) <code>status</code> TEXT Status operacional: 'ativa', 'inativa', 'manutencao' <code>data_instalacao</code> DATE Data de instalacao da estacao <code>ultima_manutencao</code> DATE Data da ultima manutencao"},{"location":"base-de-dados/#exemplo-de-dados-estacoes","title":"Exemplo de Dados (estacoes)","text":"<pre><code>INSERT INTO estacoes (id, nome, localizacao, tipo_producao, capacidade_maxima) VALUES\n(1, 'Estacao de Montagem A1', 'Nave A - Setor 1', 'Montagem de Componentes', 100),\n(2, 'Estacao de Soldadura B2', 'Nave B - Setor 2', 'Soldadura de Pecas', 80),\n(3, 'Estacao de Inspecao C1', 'Nave C - Controlo Qualidade', 'Inspecao Visual', 120);\n</code></pre>"},{"location":"base-de-dados/#2-dados_acumulados","title":"2. dados_acumulados","text":"<p>Regista metricas de producao acumuladas de cada estacao ao longo do tempo.</p> <pre><code>CREATE TABLE dados_acumulados (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    estacao_id INTEGER NOT NULL,\n    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n    producao_total INTEGER DEFAULT 0,\n    stock_atual INTEGER DEFAULT 0,\n    tempo_paragem_segundos INTEGER DEFAULT 0,\n    defeitos_total INTEGER DEFAULT 0,\n    eficiencia_percentual REAL,\n    observacoes TEXT,\n    FOREIGN KEY (estacao_id) REFERENCES estacoes(id)\n);\n</code></pre>"},{"location":"base-de-dados/#campos-dados_acumulados","title":"Campos (dados_acumulados)","text":"Campo Tipo Descricao <code>id</code> INTEGER (PK) Identificador unico do registo <code>estacao_id</code> INTEGER (FK) Referencia a estacao <code>timestamp</code> DATETIME Data e hora do registo <code>producao_total</code> INTEGER Total de pecas produzidas (acumulado) <code>stock_atual</code> INTEGER Nivel de stock atual (pecas) <code>tempo_paragem_segundos</code> INTEGER Tempo total de paragem em segundos <code>defeitos_total</code> INTEGER Total de pecas defeituosas <code>eficiencia_percentual</code> REAL Taxa de eficiencia calculada (OEE) <code>observacoes</code> TEXT Notas adicionais"},{"location":"base-de-dados/#indices","title":"Indices","text":"<pre><code>CREATE INDEX idx_estacao_timestamp ON dados_acumulados(estacao_id, timestamp);\nCREATE INDEX idx_timestamp ON dados_acumulados(timestamp DESC);\n</code></pre>"},{"location":"base-de-dados/#exemplo-de-dados-dados_acumulados","title":"Exemplo de Dados (dados_acumulados)","text":"<pre><code>INSERT INTO dados_acumulados (estacao_id, producao_total, stock_atual, tempo_paragem_segundos, defeitos_total, eficiencia_percentual) VALUES\n(1, 450, 120, 180, 5, 94.5),\n(2, 380, 95, 240, 8, 91.2),\n(3, 520, 150, 120, 2, 97.8);\n</code></pre>"},{"location":"base-de-dados/#3-produtos","title":"3. produtos","text":"<p>Catalogo de produtos/pecas fabricadas com informacao de precos.</p> <pre><code>CREATE TABLE produtos (\n    id INTEGER PRIMARY KEY,\n    codigo TEXT UNIQUE NOT NULL,\n    nome TEXT NOT NULL,\n    descricao TEXT,\n    preco_unitario REAL NOT NULL,\n    custo_producao REAL,\n    categoria TEXT,\n    unidade TEXT DEFAULT 'unidade',\n    ativo BOOLEAN DEFAULT 1,\n    data_criacao DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n</code></pre>"},{"location":"base-de-dados/#campos-produtos","title":"Campos (produtos)","text":"Campo Tipo Descricao <code>id</code> INTEGER (PK) Identificador unico do produto <code>codigo</code> TEXT (UNIQUE) Codigo do produto (SKU) <code>nome</code> TEXT (NOT NULL) Nome do produto <code>descricao</code> TEXT Descricao detalhada <code>preco_unitario</code> REAL Preco de venda unitario (EUR) <code>custo_producao</code> REAL Custo de producao unitario (EUR) <code>categoria</code> TEXT Categoria do produto <code>unidade</code> TEXT Unidade de medida <code>ativo</code> BOOLEAN Se o produto esta ativo no catalogo <code>data_criacao</code> DATETIME Data de criacao do registo"},{"location":"base-de-dados/#exemplo-de-dados-produtos","title":"Exemplo de Dados (produtos)","text":"<pre><code>INSERT INTO produtos (codigo, nome, preco_unitario, custo_producao, categoria) VALUES\n('PCB-001', 'Placa de Circuito Impresso Tipo A', 15.50, 8.20, 'Eletronica'),\n('MTL-045', 'Suporte Metalico de Fixacao', 3.80, 1.90, 'Mecanica'),\n('PLT-112', 'Tampa Plastica de Protecao', 2.10, 0.95, 'Plasticos');\n</code></pre>"},{"location":"base-de-dados/#4-relatorios","title":"4. relatorios","text":"<p>Registo de relatorios gerados automaticamente pelo sistema.</p> <pre><code>CREATE TABLE relatorios (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    data_geracao DATETIME DEFAULT CURRENT_TIMESTAMP,\n    tipo TEXT NOT NULL,\n    periodo_inicio DATE,\n    periodo_fim DATE,\n    conteudo TEXT,\n    formato TEXT DEFAULT 'HTML',\n    enviado BOOLEAN DEFAULT 0,\n    destinatarios TEXT,\n    caminho_ficheiro TEXT\n);\n</code></pre>"},{"location":"base-de-dados/#campos-relatorios","title":"Campos (relatorios)","text":"Campo Tipo Descricao <code>id</code> INTEGER (PK) Identificador unico do relatorio <code>data_geracao</code> DATETIME Data e hora de geracao <code>tipo</code> TEXT Tipo: 'diario', 'semanal', 'mensal', 'alerta' <code>periodo_inicio</code> DATE Data de inicio do periodo analisado <code>periodo_fim</code> DATE Data de fim do periodo analisado <code>conteudo</code> TEXT Conteudo do relatorio (HTML/texto) <code>formato</code> TEXT Formato: 'HTML', 'PDF', 'JSON' <code>enviado</code> BOOLEAN Se foi enviado por email <code>destinatarios</code> TEXT Emails dos destinatarios (CSV) <code>caminho_ficheiro</code> TEXT Caminho do ficheiro gerado"},{"location":"base-de-dados/#exemplo-de-dados-relatorios","title":"Exemplo de Dados (relatorios)","text":"<pre><code>INSERT INTO relatorios (tipo, periodo_inicio, periodo_fim, formato, enviado) VALUES\n('diario', '2025-12-25', '2025-12-25', 'HTML', 1),\n('semanal', '2025-12-19', '2025-12-25', 'PDF', 0);\n</code></pre>"},{"location":"base-de-dados/#views-e-consultas-uteis","title":"Views e Consultas uteis","text":""},{"location":"base-de-dados/#view-resumo-de-producao-diaria","title":"View: Resumo de Producao Diaria","text":"<pre><code>CREATE VIEW v_resumo_diario AS\nSELECT\n    e.nome AS estacao,\n    DATE(d.timestamp) AS data,\n    SUM(d.producao_total) AS total_producao,\n    SUM(d.defeitos_total) AS total_defeitos,\n    SUM(d.tempo_paragem_segundos) AS total_paragem,\n    AVG(d.eficiencia_percentual) AS eficiencia_media\nFROM dados_acumulados d\nJOIN estacoes e ON d.estacao_id = e.id\nGROUP BY e.nome, DATE(d.timestamp);\n</code></pre>"},{"location":"base-de-dados/#view-top-produtos-por-margem","title":"View: Top Produtos por Margem","text":"<pre><code>CREATE VIEW v_margem_produtos AS\nSELECT\n    codigo,\n    nome,\n    preco_unitario,\n    custo_producao,\n    (preco_unitario - custo_producao) AS margem,\n    ROUND(((preco_unitario - custo_producao) / preco_unitario * 100), 2) AS margem_percentual\nFROM produtos\nWHERE ativo = 1\nORDER BY margem DESC;\n</code></pre>"},{"location":"base-de-dados/#consulta-performance-de-estacoes-ultima-semana","title":"Consulta: Performance de Estacoes (ultima Semana)","text":"<pre><code>SELECT\n    e.nome,\n    COUNT(d.id) AS registos,\n    SUM(d.producao_total) AS producao_total,\n    SUM(d.defeitos_total) AS defeitos_total,\n    ROUND(AVG(d.eficiencia_percentual), 2) AS eficiencia_media,\n    SUM(d.tempo_paragem_segundos) / 3600.0 AS horas_paragem\nFROM dados_acumulados d\nJOIN estacoes e ON d.estacao_id = e.id\nWHERE d.timestamp &gt;= datetime('now', '-7 days')\nGROUP BY e.nome\nORDER BY producao_total DESC;\n</code></pre>"},{"location":"base-de-dados/#consulta-alertas-de-baixa-eficiencia","title":"Consulta: Alertas de Baixa Eficiencia","text":"<pre><code>SELECT\n    e.nome,\n    d.timestamp,\n    d.eficiencia_percentual,\n    d.defeitos_total,\n    d.tempo_paragem_segundos\nFROM dados_acumulados d\nJOIN estacoes e ON d.estacao_id = e.id\nWHERE d.eficiencia_percentual &lt; 85\nORDER BY d.timestamp DESC\nLIMIT 10;\n</code></pre>"},{"location":"base-de-dados/#triggers","title":"Triggers","text":""},{"location":"base-de-dados/#trigger-atualizar-eficiencia-automaticamente","title":"Trigger: Atualizar Eficiencia Automaticamente","text":"<pre><code>CREATE TRIGGER calcular_eficiencia\nAFTER INSERT ON dados_acumulados\nBEGIN\n    UPDATE dados_acumulados\n    SET eficiencia_percentual =\n        CASE\n            WHEN NEW.producao_total &gt; 0 THEN\n                ((NEW.producao_total - NEW.defeitos_total) * 100.0 / NEW.producao_total)\n            ELSE 0\n        END\n    WHERE id = NEW.id;\nEND;\n</code></pre>"},{"location":"base-de-dados/#trigger-log-de-auditoria","title":"Trigger: Log de Auditoria","text":"<pre><code>CREATE TABLE audit_log (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    tabela TEXT,\n    operacao TEXT,\n    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n    dados_anteriores TEXT,\n    dados_novos TEXT\n);\n\nCREATE TRIGGER audit_producao\nAFTER UPDATE ON dados_acumulados\nBEGIN\n    INSERT INTO audit_log (tabela, operacao, dados_anteriores, dados_novos)\n    VALUES ('dados_acumulados', 'UPDATE',\n            json_object('producao', OLD.producao_total),\n            json_object('producao', NEW.producao_total));\nEND;\n</code></pre>"},{"location":"base-de-dados/#operacoes-comuns","title":"Operacoes Comuns","text":""},{"location":"base-de-dados/#inserir-novo-registo-de-producao","title":"Inserir Novo Registo de Producao","text":"<pre><code>INSERT INTO dados_acumulados (estacao_id, producao_total, stock_atual, tempo_paragem_segundos, defeitos_total)\nVALUES (1, 458, 125, 190, 6);\n</code></pre>"},{"location":"base-de-dados/#atualizar-status-de-estacao","title":"Atualizar Status de Estacao","text":"<pre><code>UPDATE estacoes\nSET status = 'manutencao', ultima_manutencao = CURRENT_DATE\nWHERE id = 2;\n</code></pre>"},{"location":"base-de-dados/#consultar-producao-de-hoje","title":"Consultar Producao de Hoje","text":"<pre><code>SELECT * FROM dados_acumulados\nWHERE DATE(timestamp) = DATE('now')\nORDER BY timestamp DESC;\n</code></pre>"},{"location":"base-de-dados/#eliminar-dados-antigos-mais-de-1-ano","title":"Eliminar Dados Antigos (Mais de 1 Ano)","text":"<pre><code>DELETE FROM dados_acumulados\nWHERE timestamp &lt; datetime('now', '-1 year');\n</code></pre>"},{"location":"base-de-dados/#backup-e-manutencao","title":"Backup e Manutencao","text":""},{"location":"base-de-dados/#criar-backup","title":"Criar Backup","text":"<pre><code># Backup completo\nsqlite3 industrial_monitoring.db \".backup backup_$(date +%Y%m%d).db\"\n\n# Backup em SQL\nsqlite3 industrial_monitoring.db \".dump\" &gt; backup.sql\n</code></pre>"},{"location":"base-de-dados/#restaurar-backup","title":"Restaurar Backup","text":"<pre><code># Restaurar de ficheiro .db\nsqlite3 industrial_monitoring.db \".restore backup_20251226.db\"\n\n# Restaurar de SQL\nsqlite3 new_database.db &lt; backup.sql\n</code></pre>"},{"location":"base-de-dados/#otimizar-base-de-dados","title":"Otimizar Base de Dados","text":"<pre><code>-- Reindexar\nREINDEX;\n\n-- Vacuum (compactar e otimizar)\nVACUUM;\n\n-- Analisar estatisticas para optimizacao de queries\nANALYZE;\n</code></pre>"},{"location":"base-de-dados/#verificar-integridade","title":"Verificar Integridade","text":"<pre><code>PRAGMA integrity_check;\nPRAGMA foreign_key_check;\n</code></pre>"},{"location":"base-de-dados/#conexao-e-acesso","title":"Conexao e Acesso","text":""},{"location":"base-de-dados/#python","title":"Python","text":"<pre><code>import sqlite3\n\nconn = sqlite3.connect('industrial_monitoring.db')\ncursor = conn.cursor()\n\ncursor.execute(\"SELECT * FROM estacoes\")\nestacoes = cursor.fetchall()\n\nconn.close()\n</code></pre>"},{"location":"base-de-dados/#node-red","title":"Node-RED","text":"<p>Utiliza o no <code>sqlite</code> configurado com o caminho da base de dados.</p>"},{"location":"base-de-dados/#cli","title":"CLI","text":"<pre><code>sqlite3 industrial_monitoring.db\n</code></pre>"},{"location":"base-de-dados/#migracao-futura","title":"Migracao Futura","text":"<p>Para ambientes de producao, planeia-se migrar para SQL Server ou PostgreSQL (ver Fase 2).</p>"},{"location":"base-de-dados/#vantagens-da-migracao","title":"Vantagens da Migracao","text":"<ul> <li>Melhor suporte para concorrencia</li> <li>Replicacao e alta disponibilidade</li> <li>Controlo de acessos granular</li> <li>Performance em grandes volumes</li> <li>Ferramentas empresariais de gestao</li> </ul>"},{"location":"base-de-dados/#referencias","title":"Referencias","text":"<ul> <li>SQLite Documentation</li> <li>SQLite Tutorial</li> <li>DB Browser for SQLite - GUI para explorar a base de dados</li> </ul>"},{"location":"conclusao/","title":"Conclus\u00e3o e Trabalhos Futuros","text":"<p>O ProjetoISIv1 demonstrou a aplica\u00e7\u00e3o pr\u00e1tica de conceitos de Integra\u00e7\u00e3o de Sistemas de Informa\u00e7\u00e3o com recurso a ferramentas de ETL, comunica\u00e7\u00e3o IoT e visualiza\u00e7\u00e3o web.</p>"},{"location":"conclusao/#resultados","title":"Resultados","text":"<ul> <li>Automa\u00e7\u00e3o da recolha de dados via sensores simulados;  </li> <li>Processamento em tempo real com Node-RED;  </li> <li>Armazenamento persistente em SQLite;  </li> <li>Gera\u00e7\u00e3o de relat\u00f3rios autom\u00e1ticos;  </li> <li>Visualiza\u00e7\u00e3o em dashboard web.</li> </ul>"},{"location":"conclusao/#trabalhos-futuros","title":"Trabalhos Futuros","text":"<ul> <li>Migrar a base de dados para SQL Server;  </li> <li>Usar docker para todo o sistema (Mosquitto, Node-RED, UI, DB);  </li> <li>Adicionar predi\u00e7\u00f5es com IA/ML;  </li> <li>Criar alertas em tempo real (SMS/Telegram).</li> </ul>"},{"location":"dashboard/","title":"Dashboard de Visualiza\u00e7\u00e3o","text":"<p>O Dashboard do ProjetoISIv1 oferece uma interface web moderna e responsiva para monitoriza\u00e7\u00e3o em tempo real dos dados de produ\u00e7\u00e3o industrial.</p>"},{"location":"dashboard/#visao-geral","title":"Vis\u00e3o Geral","text":""},{"location":"dashboard/#tecnologias-utilizadas","title":"Tecnologias Utilizadas","text":"Tecnologia Vers\u00e3o Prop\u00f3sito React 18+ Framework frontend Material-UI (MUI) 5+ Biblioteca de componentes UI Axios 1.6+ Cliente HTTP para APIs Chart.js / Recharts - Visualiza\u00e7\u00f5es gr\u00e1ficas React Router 6+ Navega\u00e7\u00e3o entre p\u00e1ginas"},{"location":"dashboard/#funcionalidades-principais","title":"Funcionalidades Principais","text":"<ul> <li>Monitoriza\u00e7\u00e3o em tempo real de esta\u00e7\u00f5es de produ\u00e7\u00e3o</li> <li>Visualiza\u00e7\u00e3o de KPIs (Key Performance Indicators)</li> <li>Gr\u00e1ficos interativos de produ\u00e7\u00e3o, paragens e defeitos</li> <li>Hist\u00f3rico de dados com filtros por per\u00edodo</li> <li>Interface responsiva (desktop, tablet, mobile)</li> <li>Atualiza\u00e7\u00f5es autom\u00e1ticas via polling/WebSocket</li> </ul>"},{"location":"dashboard/#arquitetura-do-dashboard","title":"Arquitetura do Dashboard","text":""},{"location":"dashboard/#estrutura-de-componentes","title":"Estrutura de Componentes","text":"<pre><code>dashboard/\n  src/\n    components/\n      ProductionChart.jsx       # Gr\u00e1fico de produ\u00e7\u00e3o\n      StationStatus.jsx         # Status das esta\u00e7\u00f5es\n      DowntimeAnalysis.jsx      # An\u00e1lise de paragens\n      DefectsOverview.jsx       # Vis\u00e3o geral de defeitos\n      KPICard.jsx               # Card de KPI\n      Header.jsx                # Cabe\u00e7alho da aplica\u00e7\u00e3o\n    pages/\n      Dashboard.jsx             # P\u00e1gina principal\n      StationDetails.jsx        # Detalhes de esta\u00e7\u00e3o\n      Reports.jsx               # P\u00e1gina de relat\u00f3rios\n    services/\n      api.js                    # Configura\u00e7\u00e3o Axios\n      dataService.js            # Servi\u00e7os de dados\n    utils/\n      formatters.js             # Formata\u00e7\u00e3o de dados\n      calculations.js           # C\u00e1lculos de KPIs\n    App.jsx                     # Componente raiz\n    index.jsx                   # Ponto de entrada\n  public/\n    index.html\n    favicon.ico\n  package.json\n</code></pre>"},{"location":"dashboard/#componentes-principais","title":"Componentes Principais","text":""},{"location":"dashboard/#1-productionchart-grafico-de-producao","title":"1. ProductionChart - Gr\u00e1fico de Produ\u00e7\u00e3o","text":"<p>Exibe a produ\u00e7\u00e3o ao longo do tempo para cada esta\u00e7\u00e3o.</p> <p>Funcionalidades: - Gr\u00e1fico de linhas/barras interativo - Compara\u00e7\u00e3o entre m\u00faltiplas esta\u00e7\u00f5es - Filtros por per\u00edodo (hoje, semana, m\u00eas) - Zoom e tooltips detalhados</p> <p>Exemplo de implementa\u00e7\u00e3o (Chart.js v3+ / react-chartjs-2):</p> <pre><code>// Exemplo funcional e compat\u00edvel com Chart.js v3+\n// Requer: npm install chart.js react-chartjs-2\n\nimport React from 'react';\nimport {\n  Chart as ChartJS,\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  BarElement,\n  Title,\n  Tooltip,\n  Legend\n} from 'chart.js';\nimport { Line } from 'react-chartjs-2';\n\nChartJS.register(\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  BarElement,\n  Title,\n  Tooltip,\n  Legend\n);\n\nconst ProductionChart = ({ data }) =&gt; {\n  const chartData = {\n    labels: data.timestamps,\n    datasets: [\n      {\n        label: 'Produ\u00e7\u00e3o (pe\u00e7as)',\n        data: data.production,\n        borderColor: 'rgb(75, 192, 192)',\n        backgroundColor: 'rgba(75, 192, 192, 0.2)',\n        tension: 0.3,\n      }\n    ]\n  };\n\n  const options = {\n    responsive: true,\n    plugins: {\n      legend: { position: 'top' },\n      title: { display: false }\n    },\n    interaction: { mode: 'index', intersect: false },\n    scales: {\n      x: { display: true },\n      y: { display: true, beginAtZero: true }\n    }\n  };\n\n  return &lt;Line data={chartData} options={options} /&gt;;\n};\n\nexport default ProductionChart;\n</code></pre>"},{"location":"dashboard/#2-stationstatus-status-das-estacoess","title":"2. StationStatus - Status das Esta\u00e7\u00f5ess","text":"<p>Mostra o status operacional de cada esta\u00e7\u00e3o em tempo real.</p> <p>Estados poss\u00edveis: - Ativa (verde): Produzindo normalmente - Parada (vermelho): Em paragem - Manuten\u00e7\u00e3o (amarelo): Em manuten\u00e7\u00e3o - Offline (cinza): Sem comunica\u00e7\u00e3o</p> <p>Exemplo de layout: - Esta\u00e7\u00e3 o A1 \u2014 [\u25cf] Ativa \u2014 Produ\u00e7\u00e3o: 458 pe\u00e7as | Efici\u00eancia: 94% - Esta\u00e7\u00e3 o B2 \u2014 [\u25cf] Parada \u2014 Tempo paragem: 5m 32s</p>"},{"location":"dashboard/#3-downtimeanalysis-analise-de-paragens","title":"3. DowntimeAnalysis - An\u00e1lise de Paragens","text":"<p>Analisa os tempos de paragem e identifica padr\u00f5es.</p> <p>M\u00e9tricas exibidas: - Tempo total de paragem - N\u00famero de paragens - Dura\u00e7\u00e3o m\u00e9dia de paragem - Paragens por esta\u00e7\u00e3o (gr\u00e1fico pizza) - Timeline de paragens</p>"},{"location":"dashboard/#4-defectsoverview-visao-geral-de-defeitos","title":"4. DefectsOverview - Vis\u00e3o Geral de Defeitos","text":"<p>Monitoriza a qualidade da produ\u00e7\u00e3o atrav\u00e9s de m\u00e9tricas de defeitos.</p> <p>Visualiza\u00e7\u00f5es: - Taxa de defeitos (%) - Total de pe\u00e7as defeituosas - Compara\u00e7\u00e3o entre esta\u00e7\u00f5es - Tend\u00eancia ao longo do tempo - Top 5 esta\u00e7\u00f5es com mais defeitos</p>"},{"location":"dashboard/#5-kpicard-cartoes-de-kpi","title":"5. KPICard - Cart\u00f5es de KPI","text":"<p>Exibe indicadores-chave de performance de forma visual.</p> <p>KPIs Principais:</p> KPI Descri\u00e7\u00e3o C\u00e1lculo OEE Overall Equipment Effectiveness (Disponibilidade \u00d7 Performance \u00d7 Qualidade) \u00d7 100% Taxa de Produ\u00e7\u00e3o Pe\u00e7as produzidas/hora Total Produ\u00e7\u00e3o / Horas Opera\u00e7\u00e3o Taxa de Defeitos Percentagem de defeitos (Defeitos / Total Produ\u00e7\u00e3o) \u00d7 100% Tempo M\u00e9dio de Paragem MTTR (Mean Time To Repair) Total Paragem / N\u00famero de Paragens Disponibilidade Tempo dispon\u00edvel vs. paragem ((Tempo Total - Paragem) / Tempo Total) \u00d7 100% <p>Exemplo visual: OEE \u2014 94.5% \u00b1 2.3%</p>"},{"location":"dashboard/#paginas-do-dashboard","title":"P\u00e1ginas do Dashboard","text":""},{"location":"dashboard/#pagina-principal-dashboard","title":"P\u00e1gina Principal (Dashboard)","text":"<p>Layout: - Cabe\u00e7alho: [Logo] Monitoriza\u00e7\u00e3o Industrial | [User] [Settings] - Cards de KPIs (OEE, Produ\u00e7\u00e3o, Defeitos, Paragens) - Gr\u00e1fico de Produ\u00e7\u00e3o (linha) - Status das Esta\u00e7\u00f5es - An\u00e1lise de Paragens (barra) - Taxa de Defeitos (pizza)</p>"},{"location":"dashboard/#pagina-de-detalhes-de-estacao","title":"P\u00e1gina de Detalhes de Esta\u00e7\u00e3o","text":"<p>Exibe informa\u00e7\u00e3o detalhada sobre uma esta\u00e7\u00e3o espec\u00edfica.</p> <p>Sec\u00e7\u00f5es: 1. Informa\u00e7\u00e3o Geral (nome, localiza\u00e7\u00e3o, capacidade) 2. M\u00e9tricas em Tempo Real 3. Hist\u00f3rico de Produ\u00e7\u00e3o (\u00faltimas 24h) 4. Log de Eventos (paragens, manuten\u00e7\u00f5es) 5. Configura\u00e7\u00f5es da Esta\u00e7\u00e3o</p>"},{"location":"dashboard/#pagina-de-relatorios","title":"P\u00e1gina de Relat\u00f3rios","text":"<p>Lista relat\u00f3rios gerados e permite download.</p> <p>Funcionalidades: - Filtrar por tipo (di\u00e1rio, semanal, mensal) - Filtrar por per\u00edodo - Download em PDF/HTML - Reenviar por email - Gerar novo relat\u00f3rio ad-hoc</p>"},{"location":"dashboard/#integracao-com-backend","title":"Integra\u00e7\u00e3o com Backend","text":""},{"location":"dashboard/#configuracao-da-api","title":"Configura\u00e7\u00e3o da API","text":"<p>Ficheiro: <code>src/services/api.js</code></p> <pre><code>import axios from 'axios';\n\nconst API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';\n\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 10000,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\nexport default api;\n</code></pre>"},{"location":"dashboard/#servico-de-dados","title":"Servi\u00e7o de Dados","text":"<p>Ficheiro: <code>src/services/dataService.js</code></p> <pre><code>import api from './api';\n\nexport const dataService = {\n  // Obter dados de todas as esta\u00e7\u00f5es\n  getStations: async () =&gt; {\n    const response = await api.get('/stations');\n    return response.data;\n  },\n\n  // Obter dados acumulados\n  getAccumulatedData: async (stationId, startDate, endDate) =&gt; {\n    const response = await api.get('/accumulated-data', {\n      params: { stationId, startDate, endDate }\n    });\n    return response.data;\n  },\n\n  // Obter KPIs\n  getKPIs: async (stationId) =&gt; {\n    const response = await api.get(`/kpis/${stationId}`);\n    return response.data;\n  },\n};\n</code></pre>"},{"location":"dashboard/#atualizacao-em-tempo-real","title":"Atualiza\u00e7\u00e3o em Tempo Real","text":"<p>Op\u00e7\u00e3o 1: Polling</p> <pre><code>useEffect(() =&gt; {\n  const interval = setInterval(async () =&gt; {\n    const data = await dataService.getStations();\n    setStationsData(data);\n  }, Number(process.env.REACT_APP_REFRESH_INTERVAL) || 5000);\n\n  return () =&gt; clearInterval(interval);\n}, []);\n</code></pre> <p>Op\u00e7\u00e3o 2: WebSocket (futuro)</p> <pre><code>useEffect(() =&gt; {\n  const ws = new WebSocket(process.env.REACT_APP_MQTT_BROKER || 'ws://localhost:9001');\n\n  ws.onmessage = (event) =&gt; {\n    const data = JSON.parse(event.data);\n    updateDashboard(data);\n  };\n\n  return () =&gt; ws.close();\n}, []);\n</code></pre>"},{"location":"dashboard/#instalacao-e-configuracao","title":"Instala\u00e7\u00e3o e Configura\u00e7\u00e3o","text":"<ol> <li>Instalar depend\u00eancias</li> </ol> <pre><code>cd dashboard\nnpm install\n# instalar chart.js e react-chartjs-2 se n\u00e3o estiverem:\nnpm install chart.js react-chartjs-2\n</code></pre> <ol> <li>Configurar vari\u00e1veis de ambiente</li> </ol> <p>Crie <code>.env</code>:</p> <pre><code>REACT_APP_API_URL=http://localhost:8000\nREACT_APP_REFRESH_INTERVAL=5000\nREACT_APP_MQTT_BROKER=ws://localhost:9001\n</code></pre> <ol> <li>Executar em desenvolvimento</li> </ol> <pre><code>npm start\n</code></pre> <p>Acesse em: http://localhost:3000</p> <ol> <li>Build para produ\u00e7\u00e3o</li> </ol> <pre><code>npm run build\n</code></pre> <p>Ficheiros gerados em <code>build/</code>.</p> <ol> <li>Deploy</li> </ol> <p>Com servidor est\u00e1tico:</p> <pre><code>npm install -g serve\nserve -s build -p 3000\n</code></pre> <p>Com Nginx (exemplo):</p> <pre><code>server {\n    listen 80;\n    server_name dashboard.exemplo.com;\n\n    root /var/www/dashboard/build;\n    index index.html;\n\n    location / {\n        try_files $uri /index.html;\n    }\n\n    location /api {\n        proxy_pass http://localhost:8000;\n    }\n}\n</code></pre>"},{"location":"dashboard/#personalizacao","title":"Personaliza\u00e7\u00e3o","text":""},{"location":"dashboard/#tema-material-ui","title":"Tema Material-UI","text":"<p>Ficheiro: <code>src/theme.js</code></p> <pre><code>import { createTheme } from '@mui/material/styles';\n\nconst theme = createTheme({\n  palette: {\n    primary: { main: '#1976d2' },\n    secondary: { main: '#dc004e' },\n    success: { main: '#4caf50' },\n    warning: { main: '#ff9800' },\n    error: { main: '#f44336' },\n  },\n  typography: { fontFamily: 'Roboto, Arial, sans-serif' },\n});\n\nexport default theme;\n</code></pre>"},{"location":"dashboard/#configurar-cores-por-status","title":"Configurar Cores por Status","text":"<pre><code>const statusColors = {\n  ativa: '#4caf50',       // Verde\n  parada: '#f44336',     // Vermelho\n  manutencao: '#ff9800', // Amarelo\n  offline: '#9e9e9e',    // Cinza\n};\n</code></pre>"},{"location":"dashboard/#grafana-alternativa","title":"Grafana (Alternativa)","text":"<p>Como alternativa ao dashboard React, pode-se utilizar Grafana para visualiza\u00e7\u00f5es avan\u00e7adas.</p> <p>Vantagens do Grafana: - Dashboards configur\u00e1veis sem c\u00f3digo - Alertas personalizados - M\u00faltiplas fontes de dados - Pain\u00e9is pr\u00e9-constru\u00eddos - Partilha e exporta\u00e7\u00e3o de dashboards</p> <p>Configura\u00e7\u00e3o b\u00e1sica: 1. Instalar Grafana 2. Adicionar SQLite (ou outra fonte) como data source 3. Criar dashboard com pain\u00e9is 4. Configurar refresh autom\u00e1tico 5. Configurar alertas</p> <p>Exemplo Docker:</p> <pre><code>grafana:\n  image: grafana/grafana:latest\n  ports:\n    - \"3000:3000\"\n  volumes:\n    - grafana-storage:/var/lib/grafana\n  environment:\n    - GF_SECURITY_ADMIN_PASSWORD=admin\n</code></pre>"},{"location":"dashboard/#troubleshooting","title":"Troubleshooting","text":"<p>Dashboard n\u00e3o carrega dados: - Verificar se a API est\u00e1 a correr (<code>http://localhost:8000</code>) - Verificar configura\u00e7\u00e3o de CORS no backend - Inspecionar console do browser para erros</p> <p>Gr\u00e1ficos n\u00e3o aparecem: - Verificar se os dados t\u00eam o formato correto - Instalar depend\u00eancias de chart: <code>npm install chart.js react-chartjs-2</code> - Verificar imports e inicializa\u00e7\u00e3o do Chart.js (ChartJS.register)</p> <p>Performance lenta: - Reduzir intervalo de atualiza\u00e7\u00e3o - Implementar pagina\u00e7\u00e3o de dados - Utilizar React.memo para componentes pesados - Otimizar queries de backend</p>"},{"location":"dashboard/#proximos-passos","title":"Pr\u00f3ximos Passos","text":"<p>Ver Fase 2 para melhorias planeadas: - WebSocket para atualiza\u00e7\u00f5es em tempo real - Autentica\u00e7\u00e3o de utilizadores - Dashboards personaliz\u00e1veis por utilizador - Exporta\u00e7\u00e3o de dados - Notifica\u00e7\u00f5es push - Modo escuro (dark mode)</p>"},{"location":"dashboard/#referencias","title":"Refer\u00eancias","text":"<ul> <li>React Documentation: https://react.dev/</li> <li>Material-UI: https://mui.com/</li> <li>Chart.js: https://www.chartjs.org/</li> <li>Recharts: https://recharts.org/</li> <li>Grafana: https://grafana.com/docs/</li> </ul>"},{"location":"etl-processos/","title":"ETL PROCESSOS","text":"<p>```markdown</p>"},{"location":"etl-processos/#processos-etl-e-transformacoes","title":"Processos ETL e Transforma\u00e7\u00f5es","text":"<p>O Node-RED atua como o motor central de ETL (Extract, Transform, Load).</p>"},{"location":"etl-processos/#estrategia","title":"Estrat\u00e9gia","text":"<ol> <li>Extra\u00e7\u00e3o (Extract) </li> <li>Dados recolhidos de sensores MQTT.</li> <li> <p>Publica\u00e7\u00e3o peri\u00f3dica dos valores de produ\u00e7\u00e3o, stock e paragem.</p> </li> <li> <p>Transforma\u00e7\u00e3o (Transform) </p> </li> <li>Normaliza\u00e7\u00e3o dos dados.</li> <li>C\u00e1lculo de acumulados.</li> <li> <p>Valida\u00e7\u00e3o e filtragem de outliers.</p> </li> <li> <p>Carregamento (Load) </p> </li> <li>Inser\u00e7\u00e3o e atualiza\u00e7\u00e3o dos dados em SQLite3.</li> <li>Gera\u00e7\u00e3o de logs e relat\u00f3rios.</li> </ol>"},{"location":"etl-processos/#exemplos-de-transformacoes","title":"Exemplos de Transforma\u00e7\u00f5es","text":"Tipo Opera\u00e7\u00e3o Descri\u00e7\u00e3o Limpeza Eliminar valores nulos Ignorar mensagens sem payload v\u00e1lido Normaliza\u00e7\u00e3o Converter tipos Garantir que todos os valores s\u00e3o <code>float</code> Agrega\u00e7\u00e3o Somar produ\u00e7\u00e3o acumulada <code>acumulado += msg.payload.producao</code> Regex Extrair ID do produto <code>/produto-(\\d+)/</code> Filtro Ignorar paragens &lt; 2s <code>if (msg.payload.paragem &gt;= 2)</code>"},{"location":"etl-processos/#jobs-node-red","title":"Jobs Node-RED","text":"<p>Os fluxos Node-RED incluem:</p> <ol> <li>MQTT In \u2192 Function \u2192 SQLite Out </li> <li>Function \u2192 Python Exec \u2192 Email Out</li> </ol> <p>Esses fluxos s\u00e3o documentados visualmente no ficheiro <code>flows.json</code> e explicados no relat\u00f3rio final.</p>"},{"location":"instalacao/","title":"Pr\u00e9-requisitos e Instala\u00e7\u00e3o","text":"<p>Esta sec\u00e7\u00e3o descreve as depend\u00eancias necess\u00e1rias e o processo de instala\u00e7\u00e3o do sistema de Monitoriza\u00e7\u00e3o Industrial com IoT e ETL, incluindo a configura\u00e7\u00e3o dos componentes MQTT, Node-RED, SQLite, React UI e automa\u00e7\u00e3o com Python.</p>"},{"location":"instalacao/#pre-requisitos","title":"Pr\u00e9-requisitos","text":"<p>Antes de executar o projeto, certifica-te de que tens as seguintes ferramentas instaladas:</p>"},{"location":"instalacao/#sistema-base","title":"Sistema Base","text":"<ul> <li>Python 3.10+ \u2014 para scripts de simula\u00e7\u00e3o, integra\u00e7\u00e3o com API e envio de emails  </li> <li>Node.js 18+ \u2014 para execu\u00e7\u00e3o da interface React e Node-RED  </li> <li>npm ou yarn \u2014 gestor de pacotes JavaScript  </li> <li>SQLite3 \u2014 para armazenamento local dos dados processados  </li> <li>Mosquitto MQTT Broker \u2014 para gerir a comunica\u00e7\u00e3o entre sensores (publishers) e consumidores (subscribers)  </li> <li>Git \u2014 para controlo de vers\u00f5es e clonagem do reposit\u00f3rio  </li> </ul>"},{"location":"instalacao/#bibliotecas-python","title":"Bibliotecas Python","text":"<p>Instala as bibliotecas necess\u00e1rias:</p> <pre><code>pip install paho-mqtt requests smtplib sqlite3\n</code></pre>"},{"location":"instalacao/#dependencias-nodejs","title":"Depend\u00eancias Node.js","text":"<pre><code>npm install @mui/material @emotion/react @emotion/styled axios\n</code></pre>"},{"location":"instalacao/#node-red","title":"Node-RED","text":"<p>Instala o Node-RED globalmente:</p> <pre><code>npm install -g node-red\n</code></pre> <p>Depois, inicia com:</p> <pre><code>node-red\n</code></pre>"},{"location":"instalacao/#comandos-git","title":"Comandos Git","text":"<p>Geeks git Commands</p>"},{"location":"instalacao/#gerar-documentacao-com-mkdocs","title":"Gerar Documenta\u00e7\u00e3o com MkDocs","text":"<pre><code>pip install mkdocs mkdocs-material\nmkdocs serve\n</code></pre>"},{"location":"projeto-contexto/","title":"Contexto e Evolu\u00e7\u00e3o do Projeto","text":"<p>Esta p\u00e1gina explica a jornada do ProjetoISIv1 desde um trabalho acad\u00e9mico at\u00e9 uma potencial plataforma comercial.</p>"},{"location":"projeto-contexto/#fase-1-trabalho-academico-isi-out-dez-2024","title":"Fase 1: Trabalho Acad\u00e9mico ISI (Out-Dez 2024)","text":""},{"location":"projeto-contexto/#objetivo-original","title":"Objetivo Original","text":"<p>Aplicar conceitos de Integra\u00e7\u00e3o de Sistemas de Informa\u00e7\u00e3o num cen\u00e1rio pr\u00e1tico de monitoriza\u00e7\u00e3o industrial, focando em processos ETL e comunica\u00e7\u00e3o IoT.</p>"},{"location":"projeto-contexto/#cenario-implementado","title":"Cen\u00e1rio Implementado","text":"<p>Sistema de monitoriza\u00e7\u00e3o de linha de produ\u00e7\u00e3o com 3 esta\u00e7\u00f5es que reportam: - Produ\u00e7\u00e3o (pe\u00e7as fabricadas) - Stock (invent\u00e1rio atual) - Paragens (tempo de inatividade) - Defeitos (pe\u00e7as com problemas)</p>"},{"location":"projeto-contexto/#arquitetura-fase-1","title":"Arquitetura Fase 1","text":"<pre><code>Sensores Simulados (Python MQTT)\n         \u2193\n  Broker MQTT (Mosquitto)\n         \u2193\n  Node-RED (ETL Pipeline)\n         \u2193\n    SQLite Database\n         \u2193\n  Dashboard React + Relat\u00f3rios Email\n</code></pre>"},{"location":"projeto-contexto/#componentes-desenvolvidos","title":"Componentes Desenvolvidos","text":"<ol> <li>Simulador IoT - Gera dados sint\u00e9ticos de sensores via MQTT</li> <li>Node-RED Flows - Processa dados (adiciona timestamps, acumula m\u00e9tricas)</li> <li>Integra\u00e7\u00e3o API - Enriquece dados com pre\u00e7os de pe\u00e7as externas</li> <li>Base de Dados - Armazena hist\u00f3rico de produ\u00e7\u00e3o</li> <li>Relat\u00f3rios Autom\u00e1ticos - Python scripts enviam emails com KPIs</li> <li>Dashboard Web - Visualiza\u00e7\u00e3o em tempo real (React + Material-UI)</li> </ol>"},{"location":"projeto-contexto/#aprendizagens-chave","title":"Aprendizagens Chave","text":"<p>T\u00e9cnicas: - Comunica\u00e7\u00e3o MQTT em ambiente industrial - Padr\u00e3o publish-subscribe para desacoplamento - ETL com Node-RED (Extract-Transform-Load) - Sidecar pattern para isolamento de simula\u00e7\u00f5es - Persist\u00eancia de dados em SQLite</p> <p>Conceituais: - IoT testing requer simuladores robustos - Existe gap no mercado de simula\u00e7\u00e3o IoT acess\u00edvel - Arquitetura local funciona mas n\u00e3o escala para produ\u00e7\u00e3o - Necessidade de multi-tenancy e isolamento</p>"},{"location":"projeto-contexto/#limitacoes-identificadas","title":"Limita\u00e7\u00f5es Identificadas","text":"<ul> <li>SQLite n\u00e3o adequado para produ\u00e7\u00e3o multi-utilizador</li> <li>Docker local n\u00e3o permite acesso remoto/partilhado</li> <li>Falta de autentica\u00e7\u00e3o e gest\u00e3o de utilizadores</li> <li>Imposs\u00edvel escalar para m\u00faltiplos clientes simult\u00e2neos</li> <li>Sem API REST para gest\u00e3o program\u00e1tica</li> </ul>"},{"location":"projeto-contexto/#transicao-da-monitorizacao-a-simulacao","title":"Transi\u00e7\u00e3o: Da Monitoriza\u00e7\u00e3o \u00e0 Simula\u00e7\u00e3o","text":""},{"location":"projeto-contexto/#insight-critico","title":"Insight Cr\u00edtico","text":"<p>Durante o desenvolvimento, percebemos:</p> <p>\"Se conseguimos simular sensores para testar nosso sistema de monitoriza\u00e7\u00e3o, outros programadores tamb\u00e9m precisam dessa capacidade. Mas pagar \u20ac500+/m\u00eas por IoTIFY ou Bevywise n\u00e3o faz sentido para startups.\"</p>"},{"location":"projeto-contexto/#oportunidade-de-mercado","title":"Oportunidade de Mercado","text":"<p>Problema Real: Programadores precisam testar apps IoT sem comprar hardware. Solu\u00e7\u00f5es Existentes: Caras (\u20ac500+/m\u00eas) ou complexas (AWS IoT Device Simulator). Nossa Proposta: Simula\u00e7\u00e3o IoT simples e acess\u00edvel, pay-as-you-go.</p> <p>Mercado: \u20ac714B de IoT em 2025, startups e consultoras s\u00e3o target inicial.</p>"},{"location":"projeto-contexto/#fase-2-iot-simulator-platform-jan-2025","title":"Fase 2: IoT Simulator Platform (Jan 2025+)","text":""},{"location":"projeto-contexto/#visao","title":"Vis\u00e3o","text":"<p>Plataforma SaaS que permite criar sensores IoT virtuais via API REST, eliminando necessidade de hardware para testes e desenvolvimento.</p>"},{"location":"projeto-contexto/#transformacoes-necessarias","title":"Transforma\u00e7\u00f5es Necess\u00e1rias","text":"Aspecto Fase 1 (Acad\u00e9mico) Fase 2 (Comercial) Deploy Docker local Kubernetes cloud DB SQLite PostgreSQL API Inexistente FastAPI REST Auth Nenhuma JWT tokens Pre\u00e7o Gratuito Pay-as-you-go Multi-tenant N\u00e3o Sim (pods isolados) Escala 1 utilizador Centenas"},{"location":"projeto-contexto/#nova-arquitetura-fase-2","title":"Nova Arquitetura (Fase 2)","text":"<pre><code>User Request \u2192 FastAPI\n              \u2193\n         PostgreSQL (metadata)\n              \u2193\n    Kubernetes Orchestrator\n              \u2193\n   [Pod 1]  [Pod 2]  [Pod N]\n   MQTT+Sim MQTT+Sim MQTT+Sim\n              \u2193\n    User Application (test)\n</code></pre> <p>Conceito-chave: Cada simula\u00e7\u00e3o corre num pod isolado com MQTT broker + simulador pr\u00f3prios.</p>"},{"location":"projeto-contexto/#funcionalidades-planeadas","title":"Funcionalidades Planeadas","text":"<p>MVP (3 meses): - Criar/parar simula\u00e7\u00f5es via API - Configurar sensores (tipo, frequ\u00eancia, dados) - MQTT isolado por simula\u00e7\u00e3o - Monitoriza\u00e7\u00e3o b\u00e1sica de recursos - Pay-as-you-go \u20ac0.10/hora</p> <p>P\u00f3s-MVP: - Templates de sensores pr\u00e9-configurados - Webhooks para eventos - Simula\u00e7\u00e3o de cen\u00e1rios complexos - Dashboard de gest\u00e3o de simula\u00e7\u00f5es - Integra\u00e7\u00f5es (Azure IoT Hub, AWS IoT Core)</p>"},{"location":"projeto-contexto/#roadmap-tecnico","title":"Roadmap T\u00e9cnico","text":"<p>Ver detalhes completos em Fase 2 Roadmap.</p> <p>Q1 2025: MVP funcional, valida\u00e7\u00e3o de clientes (10 early adopters) Q2 2025: Beta p\u00fablica, landing page, primeiros clientes pagantes Q3 2025: Produ\u00e7\u00e3o est\u00e1vel, features avan\u00e7adas Q4 2025: Escala para 100+ utilizadores</p>"},{"location":"projeto-contexto/#como-a-fase-1-informou-a-fase-2","title":"Como a Fase 1 Informou a Fase 2","text":""},{"location":"projeto-contexto/#validacoes-tecnicas","title":"Valida\u00e7\u00f5es T\u00e9cnicas","text":"<ol> <li>Sidecar pattern funciona - Cada simula\u00e7\u00e3o isolada num container</li> <li>MQTT \u00e9 protocolo certo - Amplamente adotado em IoT</li> <li>Simplicidade vende - Configura\u00e7\u00e3o JSON simples \u00e9 suficiente</li> <li>Cleanup autom\u00e1tico \u00e9 cr\u00edtico - Simula\u00e7\u00f5es devem expirar automaticamente</li> </ol>"},{"location":"projeto-contexto/#decisoes-arquiteturais","title":"Decis\u00f5es Arquiteturais","text":"<p>Da experi\u00eancia Fase 1, decidimos:</p> <ul> <li>Kubernetes em vez de Docker Compose - Melhor orquestra\u00e7\u00e3o</li> <li>PostgreSQL em vez de SQLite - Suporta concorr\u00eancia</li> <li>FastAPI em vez de Node-RED - Mais controlo program\u00e1tico</li> <li>Redis para rate limiting - Evitar abuso da API</li> <li>Prometheus/Grafana - Monitoriza\u00e7\u00e3o desde o in\u00edcio</li> </ul>"},{"location":"projeto-contexto/#licoes-de-produto","title":"Li\u00e7\u00f5es de Produto","text":"<p>O que funcionou: - Configura\u00e7\u00e3o via JSON \u00e9 intuitiva - Dados sint\u00e9ticos realistas s\u00e3o valiosos - Visualiza\u00e7\u00e3o em tempo real \u00e9 esperada</p> <p>O que faltou: - Gest\u00e3o de m\u00faltiplas simula\u00e7\u00f5es - Autentica\u00e7\u00e3o e billing - API para automa\u00e7\u00e3o - Templates reutiliz\u00e1veis</p>"},{"location":"projeto-contexto/#estado-atual-dez-2024","title":"Estado Atual (Dez 2024)","text":""},{"location":"projeto-contexto/#fase-1-completa","title":"Fase 1: \u2705 Completa","text":"<ul> <li>C\u00f3digo funcional e documentado</li> <li>Apresenta\u00e7\u00e3o acad\u00e9mica aprovada</li> <li>Reposit\u00f3rio p\u00fablico dispon\u00edvel</li> </ul>"},{"location":"projeto-contexto/#fase-2-em-desenvolvimento","title":"Fase 2: \ud83d\udea7 Em Desenvolvimento","text":"<p>Completado: - Pesquisa de mercado (\u20ac714B TAM, gap identificado) - Arquitetura t\u00e9cnica definida - MVP com FastAPI + Docker funcionando - Error handling robusto implementado</p> <p>Em Progresso: - Transi\u00e7\u00e3o para Kubernetes - Sistema de billing - Landing page para valida\u00e7\u00e3o</p> <p>Pr\u00f3ximos Passos: - Entrevistas com potenciais clientes - Load testing e isolamento - Deploy em cloud provider - Beta privada com early adopters</p>"},{"location":"projeto-contexto/#recursos-relacionados","title":"Recursos Relacionados","text":"<p>Fase 1: - Arquitetura T\u00e9cnica - Node-RED Flows - Dashboard</p> <p>Fase 2: - IoT Simulator Platform Roadmap - Reposit\u00f3rio API (em constru\u00e7\u00e3o) - Landing Page (em constru\u00e7\u00e3o)</p>"},{"location":"projeto-contexto/#conclusao","title":"Conclus\u00e3o","text":"<p>O ProjetoISIv1 come\u00e7ou como explora\u00e7\u00e3o acad\u00e9mica de ETL e IoT, mas revelou uma oportunidade real de mercado. A experi\u00eancia t\u00e9cnica da Fase 1 validou conceitos fundamentais que agora evoluem para uma plataforma comercial vi\u00e1vel.</p> <p>Fase 1 ensinou-nos como construir sistemas IoT integrados. Fase 2 aplica esse conhecimento para resolver um problema real de mercado.</p> <p>Esta documenta\u00e7\u00e3o serve ambas as fases, mantendo o hist\u00f3rico acad\u00e9mico enquanto suporta o desenvolvimento comercial.</p>"},{"location":"relatorios-emails/","title":"Relat\u00f3rios e Emails Autom\u00e1ticos","text":"<p>Sistema de gera\u00e7\u00e3o e envio autom\u00e1tico de relat\u00f3rios de produ\u00e7\u00e3o por email.</p>"},{"location":"relatorios-emails/#visao-geral","title":"Vis\u00e3o Geral","text":"<p>Objetivo: Enviar relat\u00f3rios di\u00e1rios/semanais com KPIs de produ\u00e7\u00e3o sem interven\u00e7\u00e3o manual.</p> <p>Tecnologia: Python scripts + SQLite + SMTP</p> <p>Trigger: Agendado via cron ou executado por Node-RED</p>"},{"location":"relatorios-emails/#tipos-de-relatorios","title":"Tipos de Relat\u00f3rios","text":""},{"location":"relatorios-emails/#1-relatorio-diario","title":"1. Relat\u00f3rio Di\u00e1rio","text":"<p>Resumo das \u00faltimas 24h de produ\u00e7\u00e3o.</p> <p>Conte\u00fado: - Total produzido por esta\u00e7\u00e3o - Tempo de paragens - Taxa de defeitos - Efici\u00eancia (OEE)</p> <p>Destinat\u00e1rios: Supervisores de produ\u00e7\u00e3o</p> <p>Frequ\u00eancia: Todos os dias \u00e0s 7h00</p>"},{"location":"relatorios-emails/#2-relatorio-semanal","title":"2. Relat\u00f3rio Semanal","text":"<p>An\u00e1lise agregada da semana anterior.</p> <p>Conte\u00fado: - Tend\u00eancias de produ\u00e7\u00e3o - Compara\u00e7\u00e3o entre esta\u00e7\u00f5es - Top 5 problemas - Recomenda\u00e7\u00f5es</p> <p>Destinat\u00e1rios: Gest\u00e3o</p> <p>Frequ\u00eancia: Segundas-feiras \u00e0s 9h00</p>"},{"location":"relatorios-emails/#3-alertas-em-tempo-real","title":"3. Alertas em Tempo Real","text":"<p>Notifica\u00e7\u00f5es imediatas de anomalias.</p> <p>Triggers: - Paragem &gt; 10 minutos - Defeitos &gt; 5% da produ\u00e7\u00e3o - Efici\u00eancia &lt; 80% - Stock cr\u00edtico (&lt; 20 unidades)</p> <p>M\u00e9todo: Email ou SMS (futuro)</p>"},{"location":"relatorios-emails/#estrutura-do-relatorio","title":"Estrutura do Relat\u00f3rio","text":""},{"location":"relatorios-emails/#template-html","title":"Template HTML","text":"<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;style&gt;\n        body { font-family: Arial, sans-serif; }\n        .kpi { display: inline-block; padding: 20px; margin: 10px; background: #f0f0f0; border-radius: 8px; }\n        .kpi-value { font-size: 32px; font-weight: bold; color: #1976d2; }\n        .kpi-label { font-size: 14px; color: #666; }\n        .alert { background: #ffebee; border-left: 4px solid #f44336; padding: 10px; margin: 10px 0; }\n        table { width: 100%; border-collapse: collapse; }\n        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }\n        th { background: #1976d2; color: white; }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h1&gt;Relat\u00f3rio de Produ\u00e7\u00e3o - {data}&lt;/h1&gt;\n\n    &lt;div class=\"kpis\"&gt;\n        &lt;div class=\"kpi\"&gt;\n            &lt;div class=\"kpi-value\"&gt;{producao_total}&lt;/div&gt;\n            &lt;div class=\"kpi-label\"&gt;Pe\u00e7as Produzidas&lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div class=\"kpi\"&gt;\n            &lt;div class=\"kpi-value\"&gt;{oee}%&lt;/div&gt;\n            &lt;div class=\"kpi-label\"&gt;OEE&lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div class=\"kpi\"&gt;\n            &lt;div class=\"kpi-value\"&gt;{defeitos}%&lt;/div&gt;\n            &lt;div class=\"kpi-label\"&gt;Taxa de Defeitos&lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    {alertas_html}\n\n    &lt;h2&gt;Produ\u00e7\u00e3o por Esta\u00e7\u00e3o&lt;/h2&gt;\n    &lt;table&gt;\n        &lt;tr&gt;\n            &lt;th&gt;Esta\u00e7\u00e3o&lt;/th&gt;\n            &lt;th&gt;Produ\u00e7\u00e3o&lt;/th&gt;\n            &lt;th&gt;Paragens (min)&lt;/th&gt;\n            &lt;th&gt;Defeitos&lt;/th&gt;\n            &lt;th&gt;Efici\u00eancia&lt;/th&gt;\n        &lt;/tr&gt;\n        {tabela_estacoes}\n    &lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"relatorios-emails/#implementacao-python","title":"Implementa\u00e7\u00e3o Python","text":""},{"location":"relatorios-emails/#script-principal-report_generatorpy","title":"Script Principal: <code>report_generator.py</code>","text":"<pre><code>import sqlite3\nimport smtplib\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEMultipart\nfrom datetime import datetime, timedelta\nimport os\n\nclass ReportGenerator:\n    def __init__(self, db_path='industrial_monitoring.db'):\n        self.db_path = db_path\n        self.smtp_server = os.getenv('SMTP_SERVER', 'smtp.gmail.com')\n        self.smtp_port = int(os.getenv('SMTP_PORT', '587'))\n        self.email_from = os.getenv('EMAIL_FROM')\n        self.email_password = os.getenv('EMAIL_PASSWORD')\n\n    def get_daily_data(self):\n        \"\"\"Busca dados das \u00faltimas 24h\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        cursor = conn.cursor()\n\n        query = \"\"\"\n        SELECT \n            e.nome,\n            SUM(d.producao_total) as total_producao,\n            SUM(d.tempo_paragem_segundos)/60 as paragens_min,\n            SUM(d.defeitos_total) as total_defeitos,\n            AVG(d.eficiencia_percentual) as eficiencia\n        FROM dados_acumulados d\n        JOIN estacoes e ON d.estacao_id = e.id\n        WHERE d.timestamp &gt;= datetime('now', '-1 day')\n        GROUP BY e.nome\n        \"\"\"\n\n        cursor.execute(query)\n        results = cursor.fetchall()\n        conn.close()\n\n        return results\n\n    def calculate_kpis(self, data):\n        \"\"\"Calcula KPIs agregados\"\"\"\n        total_producao = sum(row[1] for row in data)\n        total_defeitos = sum(row[3] for row in data)\n        avg_eficiencia = sum(row[4] for row in data) / len(data) if data else 0\n        taxa_defeitos = (total_defeitos / total_producao * 100) if total_producao &gt; 0 else 0\n\n        return {\n            'producao_total': total_producao,\n            'oee': round(avg_eficiencia, 1),\n            'defeitos': round(taxa_defeitos, 2)\n        }\n\n    def generate_html_report(self, data, kpis):\n        \"\"\"Gera relat\u00f3rio HTML\"\"\"\n        # Template HTML (simplificado para exemplo)\n        template = \"\"\"\n        &lt;html&gt;\n        &lt;body&gt;\n            &lt;h1&gt;Relat\u00f3rio Di\u00e1rio - {data}&lt;/h1&gt;\n            &lt;p&gt;Produ\u00e7\u00e3o Total: {producao_total} pe\u00e7as&lt;/p&gt;\n            &lt;p&gt;OEE: {oee}%&lt;/p&gt;\n            &lt;p&gt;Taxa Defeitos: {defeitos}%&lt;/p&gt;\n\n            &lt;h2&gt;Detalhes por Esta\u00e7\u00e3o&lt;/h2&gt;\n            &lt;table border=\"1\"&gt;\n                &lt;tr&gt;&lt;th&gt;Esta\u00e7\u00e3o&lt;/th&gt;&lt;th&gt;Produ\u00e7\u00e3o&lt;/th&gt;&lt;th&gt;Paragens&lt;/th&gt;&lt;th&gt;Defeitos&lt;/th&gt;&lt;/tr&gt;\n                {rows}\n            &lt;/table&gt;\n        &lt;/body&gt;\n        &lt;/html&gt;\n        \"\"\"\n\n        rows = \"\"\n        for row in data:\n            rows += f\"&lt;tr&gt;&lt;td&gt;{row[0]}&lt;/td&gt;&lt;td&gt;{row[1]}&lt;/td&gt;&lt;td&gt;{row[2]:.0f}min&lt;/td&gt;&lt;td&gt;{row[3]}&lt;/td&gt;&lt;/tr&gt;\"\n\n        return template.format(\n            data=datetime.now().strftime('%Y-%m-%d'),\n            producao_total=kpis['producao_total'],\n            oee=kpis['oee'],\n            defeitos=kpis['defeitos'],\n            rows=rows\n        )\n\n    def send_email(self, html_content, recipients):\n        \"\"\"Envia email com relat\u00f3rio\"\"\"\n        msg = MIMEMultipart('alternative')\n        msg['Subject'] = f\"Relat\u00f3rio de Produ\u00e7\u00e3o - {datetime.now().strftime('%Y-%m-%d')}\"\n        msg['From'] = self.email_from\n        msg['To'] = ', '.join(recipients)\n\n        html_part = MIMEText(html_content, 'html')\n        msg.attach(html_part)\n\n        with smtplib.SMTP(self.smtp_server, self.smtp_port) as server:\n            server.starttls()\n            server.login(self.email_from, self.email_password)\n            server.send_message(msg)\n\n    def run_daily_report(self):\n        \"\"\"Executa relat\u00f3rio di\u00e1rio completo\"\"\"\n        data = self.get_daily_data()\n        kpis = self.calculate_kpis(data)\n        html = self.generate_html_report(data, kpis)\n\n        recipients = os.getenv('REPORT_RECIPIENTS', '').split(',')\n        self.send_email(html, recipients)\n\n        print(f\"Relat\u00f3rio enviado para {len(recipients)} destinat\u00e1rios\")\n\n# Uso\nif __name__ == '__main__':\n    generator = ReportGenerator()\n    generator.run_daily_report()\n</code></pre>"},{"location":"relatorios-emails/#configuracao-smtp","title":"Configura\u00e7\u00e3o SMTP","text":""},{"location":"relatorios-emails/#gmail-recomendado","title":"Gmail (Recomendado)","text":"<ol> <li>Criar App Password: Google Account Security</li> <li>Configurar vari\u00e1veis de ambiente:</li> </ol> <pre><code>export SMTP_SERVER=\"smtp.gmail.com\"\nexport SMTP_PORT=\"587\"\nexport EMAIL_FROM=\"producao@empresa.com\"\nexport EMAIL_PASSWORD=\"xxxx xxxx xxxx xxxx\"  # App Password\nexport REPORT_RECIPIENTS=\"supervisor@empresa.com,gestor@empresa.com\"\n</code></pre>"},{"location":"relatorios-emails/#outlook","title":"Outlook","text":"<pre><code>export SMTP_SERVER=\"smtp-mail.outlook.com\"\nexport SMTP_PORT=\"587\"\n</code></pre>"},{"location":"relatorios-emails/#gmail-empresarial-google-workspace","title":"Gmail Empresarial (Google Workspace)","text":"<p>Mesmo que Gmail pessoal, mas usar email empresarial.</p>"},{"location":"relatorios-emails/#agendamento-automatico","title":"Agendamento Autom\u00e1tico","text":""},{"location":"relatorios-emails/#cron-linuxmac","title":"Cron (Linux/Mac)","text":"<p>Editar crontab: <pre><code>crontab -e\n</code></pre></p> <p>Adicionar: <pre><code># Relat\u00f3rio di\u00e1rio \u00e0s 7h\n0 7 * * * cd /path/to/project &amp;&amp; python report_generator.py\n\n# Relat\u00f3rio semanal \u00e0s segundas 9h\n0 9 * * 1 cd /path/to/project &amp;&amp; python weekly_report.py\n</code></pre></p>"},{"location":"relatorios-emails/#windows-task-scheduler","title":"Windows Task Scheduler","text":"<ol> <li>Abrir Task Scheduler</li> <li>Create Basic Task</li> <li>Trigger: Daily, 7:00 AM</li> <li>Action: Start a program</li> <li>Program: <code>python.exe</code></li> <li>Arguments: <code>C:\\path\\to\\report_generator.py</code></li> </ol>"},{"location":"relatorios-emails/#node-red-recomendado","title":"Node-RED (Recomendado)","text":"<p>Usar node <code>inject</code> com cron:</p> <pre><code>{\n    \"id\": \"schedule_daily_report\",\n    \"type\": \"inject\",\n    \"cron\": \"0 7 * * *\",\n    \"name\": \"Trigger Daily Report\",\n    \"wires\": [[\"exec_python_report\"]]\n}\n</code></pre>"},{"location":"relatorios-emails/#alertas-em-tempo-real","title":"Alertas em Tempo Real","text":""},{"location":"relatorios-emails/#integracao-node-red","title":"Integra\u00e7\u00e3o Node-RED","text":"<p>Flow para detectar anomalias:</p> <pre><code>// Node: function \"Detect Anomalies\"\nif (msg.payload.dados.paragem &gt; 600) { // 10 min\n    msg.alert = {\n        tipo: \"PARAGEM_LONGA\",\n        estacao: msg.payload.estacao,\n        duracao: msg.payload.dados.paragem,\n        severidade: \"alta\"\n    };\n    return msg;\n}\n\nif (msg.payload.dados.defeitos / msg.payload.dados.producao &gt; 0.05) {\n    msg.alert = {\n        tipo: \"DEFEITOS_ELEVADOS\",\n        estacao: msg.payload.estacao,\n        taxa: (msg.payload.dados.defeitos / msg.payload.dados.producao * 100).toFixed(2),\n        severidade: \"m\u00e9dia\"\n    };\n    return msg;\n}\n\nreturn null; // Sem alerta\n</code></pre> <p>Conectar a node <code>exec</code> que executa: <pre><code>python send_alert_email.py --tipo \"${alert.tipo}\" --estacao \"${alert.estacao}\"\n</code></pre></p>"},{"location":"relatorios-emails/#exemplo-de-email-recebido","title":"Exemplo de Email Recebido","text":"<pre><code>Assunto: Relat\u00f3rio de Produ\u00e7\u00e3o - 2024-12-28\n\nRelat\u00f3rio Di\u00e1rio de Produ\u00e7\u00e3o\n-----------------------------\n\nKPIs Gerais:\n\u2713 Produ\u00e7\u00e3o Total: 1,358 pe\u00e7as\n\u2713 OEE: 94.5%\n\u26a0 Taxa de Defeitos: 1.2%\n\nProdu\u00e7\u00e3o por Esta\u00e7\u00e3o:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Esta\u00e7\u00e3o     \u2502 Produ\u00e7\u00e3o \u2502 Paragens \u2502 Defeitos \u2502 Efici\u00eancia \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Esta\u00e7\u00e3o A1  \u2502 458      \u2502 3 min    \u2502 5        \u2502 95.2%      \u2502\n\u2502 Esta\u00e7\u00e3o B2  \u2502 420      \u2502 8 min    \u2502 8        \u2502 92.1%      \u2502\n\u2502 Esta\u00e7\u00e3o C1  \u2502 480      \u2502 2 min    \u2502 3        \u2502 96.8%      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nAlertas:\n\u26a0 Esta\u00e7\u00e3o B2: Tempo de paragem acima do normal\n</code></pre>"},{"location":"relatorios-emails/#melhorias-futuras","title":"Melhorias Futuras","text":"<ul> <li>Gr\u00e1ficos embutidos (matplotlib \u2192 imagem inline)</li> <li>Compara\u00e7\u00e3o com dia/semana anterior</li> <li>Previs\u00f5es baseadas em tend\u00eancias</li> <li>Anexar PDF do relat\u00f3rio</li> <li>Integra\u00e7\u00e3o Telegram/Slack para alertas</li> <li>Dashboard web para hist\u00f3rico de relat\u00f3rios</li> </ul>"},{"location":"relatorios-emails/#troubleshooting","title":"Troubleshooting","text":"<p>Emails n\u00e3o enviados: - Verificar App Password do Gmail - Testar SMTP manualmente: <code>telnet smtp.gmail.com 587</code> - Verificar firewall/antiv\u00edrus</p> <p>Dados vazios no relat\u00f3rio: - Confirmar que h\u00e1 dados nas \u00faltimas 24h no SQLite - Verificar query SQL no script</p> <p>Cron n\u00e3o executa: - Verificar logs: <code>grep CRON /var/log/syslog</code> - Testar script manualmente primeiro - Usar caminhos absolutos no cron</p>"},{"location":"relatorios-emails/#referencias","title":"Refer\u00eancias","text":"<ul> <li>Python smtplib</li> <li>Gmail SMTP</li> <li>Cron Syntax</li> </ul>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"Problema Causa prov\u00e1vel Solu\u00e7\u00e3o Node-RED n\u00e3o liga Porta ocupada Muda a porta: <code>node-red -p 1881</code> MQTT n\u00e3o conecta Broker offline Reinicia Mosquitto: <code>sudo systemctl restart mosquitto</code> SQLite bloqueado Conflito de acesso Fecha outras conex\u00f5es e tenta novamente Emails n\u00e3o enviados Autentica\u00e7\u00e3o falhou Verifica SMTP e permiss\u00f5es \u201cApp Password\u201d"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/","title":"Roadmap Completo - Plataforma de Simula\u00e7\u00e3o IoT","text":"<p>Projeto: Sistema de Simula\u00e7\u00e3o IoT sob Demanda Objetivo: API REST que provisiona simuladores MQTT dinamicamente Stack Base: Python + FastAPI + Docker + MQTT Dura\u00e7\u00e3o Total: 12-16 semanas (3 fases)</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#visao-geral","title":"Vis\u00e3o Geral","text":"<pre><code>Fase 1 (MVP)          Fase 2 (Kubernetes)     Fase 3 (Produ\u00e7\u00e3o)\nSemanas 1-4           Semanas 5-10            Semanas 11-16\n    \u2502                      \u2502                        \u2502\n    \u251c\u2500 API REST           \u251c\u2500 K8s Client            \u251c\u2500 CI/CD\n    \u251c\u2500 Docker Local       \u251c\u2500 Pods Din\u00e2micos        \u251c\u2500 Monitoring\n    \u251c\u2500 SQLite             \u251c\u2500 PostgreSQL            \u251c\u2500 Auth/Billing\n    \u2514\u2500 Demo Funcional     \u2514\u2500 Multi-User            \u2514\u2500 Deploy Cloud\n</code></pre> <p>Estado Atual: Fase 1 - 70% completo (API + Docker + SQLite funcionais)</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#fase-1-mvp-funcional-4-semanas","title":"FASE 1 - MVP Funcional (4 semanas)","text":"<p>Objetivo: Sistema local funcional para demonstra\u00e7\u00e3o universit\u00e1ria Entreg\u00e1veis: API REST + Docker + SQLite + Documenta\u00e7\u00e3o + Demo</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#semana-1-core-implementation-atual","title":"Semana 1: Core Implementation (ATUAL)","text":"<p>Status: \ud83d\udfe1 Em Progresso</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#dia-1-2-finalizar-integracao-docker","title":"Dia 1-2: Finalizar Integra\u00e7\u00e3o Docker","text":"<ul> <li>[x] Pull da imagem <code>ghcr.io/damascenorafael/mqtt-simulator:sha-a73a2e8</code></li> <li>[x] API cria containers com config JSON</li> <li>[x] Adicionar flag <code>-f</code> no comando Docker</li> <li>[ ] Testar: Container l\u00ea config corretamente</li> <li>[ ] Validar: <code>docker logs</code> mostra t\u00f3picos configurados</li> </ul> <p>C\u00f3digo-chave: <pre><code>container = docker_client.containers.run(\n    \"ghcr.io/damascenorafael/mqtt-simulator:sha-a73a2e8\",\n    command=[\"-f\", \"/config/settings.json\"],\n    volumes={config_path: {'bind': '/config/settings.json', 'mode': 'ro'}},\n    detach=True,\n    remove=True\n)\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#dia-3-4-persistencia-sqlite","title":"Dia 3-4: Persist\u00eancia SQLite","text":"<ul> <li>[x] Modelo <code>Simulation</code> com SQLAlchemy</li> <li>[x] Endpoints CRUD completos</li> <li>[ ] Corrigir: Health check database \"disconnected\"</li> <li>[ ] Adicionar: Campo <code>expires_at</code> na tabela</li> <li>[ ] Implementar: Cleanup de expirados ao startup</li> </ul> <p>Tasks espec\u00edficas: <pre><code># Recriar BD com novo campo\nrm simulations.db\npython3 -c \"from database import Base, engine; Base.metadata.create_all(bind=engine)\"\n\n# Adicionar ao database.py\nexpires_at = Column(DateTime, nullable=False)\n\n# Adicionar ao main.py startup\n@app.on_event(\"startup\")\nasync def startup_event():\n    cleanup_expired_simulations()\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#dia-5-7-auto-stop-e-cleanup","title":"Dia 5-7: Auto-Stop e Cleanup","text":"<ul> <li>[x] Thread para auto-stop ap\u00f3s dura\u00e7\u00e3o</li> <li>[ ] Implementar: Fun\u00e7\u00e3o <code>cleanup_expired_simulations()</code></li> <li>[ ] Testar: Criar simula\u00e7\u00e3o 2 min \u2192 para automaticamente</li> <li>[ ] Testar: Reiniciar API \u2192 containers \u00f3rf\u00e3os limpos</li> <li>[ ] Validar: BD atualiza status para \"expired\"</li> </ul> <p>Checklist de Valida\u00e7\u00e3o: - [ ] Container para ap\u00f3s <code>duration_minutes</code> - [ ] BD atualiza <code>stopped_at</code> e <code>status='expired'</code> - [ ] Ficheiro config tempor\u00e1rio \u00e9 removido - [ ] Containers \u00f3rf\u00e3os limpos ao reiniciar API</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#semana-2-robustez-e-error-handling","title":"Semana 2: Robustez e Error Handling","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#dia-8-9-tratamento-de-erros","title":"Dia 8-9: Tratamento de Erros","text":"<ul> <li>[ ] Try/catch robusto em todos endpoints</li> <li>[ ] Valida\u00e7\u00e3o Pydantic completa (todos campos obrigat\u00f3rios)</li> <li>[ ] Mensagens de erro descritivas</li> <li>[ ] HTTP status codes corretos (404, 422, 500)</li> </ul> <p>Endpoints a revisar: <pre><code># POST /simulations\n- 422: Config JSON inv\u00e1lido\n- 404: Docker image n\u00e3o encontrada\n- 500: Erro ao criar container\n\n# GET /simulations/{id}\n- 404: Simula\u00e7\u00e3o n\u00e3o existe\n- 200: Retorna logs mesmo se container parou\n\n# DELETE /simulations/{id}\n- 404: Simula\u00e7\u00e3o n\u00e3o existe\n- 400: Simula\u00e7\u00e3o j\u00e1 parada\n- 204: Sucesso\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#dia-10-11-features-adicionais","title":"Dia 10-11: Features Adicionais","text":"<ul> <li>[ ] Endpoint <code>GET /simulations?status=running&amp;limit=20</code></li> <li>[ ] Endpoint <code>GET /stats</code> (total, running, stopped, expired)</li> <li>[ ] Endpoint <code>GET /simulations/{id}/logs</code> (\u00faltimas 100 linhas)</li> <li>[ ] Response models Pydantic para todos endpoints</li> </ul> <p>C\u00f3digo exemplo: <pre><code>@app.get(\"/simulations\", response_model=List[SimulationListItem])\nasync def list_simulations(\n    status: Optional[str] = None,\n    limit: int = Query(default=20, ge=1, le=100),\n    offset: int = Query(default=0, ge=0),\n    db: Session = Depends(get_db)\n):\n    query = db.query(Simulation)\n\n    if status:\n        query = query.filter(Simulation.status == status)\n\n    total = query.count()\n    sims = query.order_by(Simulation.created_at.desc()).offset(offset).limit(limit).all()\n\n    return {\n        \"total\": total,\n        \"limit\": limit,\n        \"offset\": offset,\n        \"simulations\": [...]\n    }\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#dia-12-14-testes-manuais-completos","title":"Dia 12-14: Testes Manuais Completos","text":"<ul> <li>[ ] Criar 5 configs JSON diferentes (single, multiple, list topics)</li> <li>[ ] Testar cada endpoint com Postman/curl</li> <li>[ ] Stress test: criar 10 simula\u00e7\u00f5es simult\u00e2neas</li> <li>[ ] Load test: criar \u2192 parar \u2192 criar 50x</li> <li>[ ] Verificar memory leaks (containers n\u00e3o limpos)</li> </ul> <p>Checklist de Testes: <pre><code># Test 1: Happy path\ncurl -X POST http://localhost:8000/simulations -d @config.json\n# Verificar: container ativo, BD tem entrada, logs funcionam\n\n# Test 2: Config inv\u00e1lido\ncurl -X POST http://localhost:8000/simulations -d '{\"invalid\": true}'\n# Verificar: retorna 422 com mensagem clara\n\n# Test 3: Listar e filtrar\ncurl http://localhost:8000/simulations?status=running\n# Verificar: s\u00f3 mostra simula\u00e7\u00f5es ativas\n\n# Test 4: Auto-stop\n# Criar simula\u00e7\u00e3o 1 min, esperar \u2192 container deve parar\n\n# Test 5: Cleanup ap\u00f3s restart\n# Criar 3 simula\u00e7\u00f5es, matar API (Ctrl+C), reiniciar\n# Verificar: simula\u00e7\u00f5es expiradas t\u00eam status correto\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#semana-3-documentacao-e-cliente-de-teste","title":"Semana 3: Documenta\u00e7\u00e3o e Cliente de Teste","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#dia-15-16-readmemd-completo","title":"Dia 15-16: README.md Completo","text":"<ul> <li>[ ] Sec\u00e7\u00e3o \"Instala\u00e7\u00e3o\" passo-a-passo</li> <li>[ ] Sec\u00e7\u00e3o \"Configura\u00e7\u00e3o\" (Docker, SQLite)</li> <li>[ ] Sec\u00e7\u00e3o \"Uso\" com exemplos de curl/Postman</li> <li>[ ] Sec\u00e7\u00e3o \"Arquitetura\" com diagrama</li> <li>[ ] Sec\u00e7\u00e3o \"API Reference\" (ou link para Swagger)</li> <li>[ ] Screenshots do Swagger UI</li> </ul> <p>Template README.md: <pre><code># IoT Simulator Platform\n\nAPI REST para criar simuladores IoT sob demanda usando Docker.\n\n## Features\n- \u2705 Cria\u00e7\u00e3o din\u00e2mica de simuladores MQTT\n- \u2705 Configura\u00e7\u00e3o JSON flex\u00edvel\n- \u2705 Auto-stop ap\u00f3s dura\u00e7\u00e3o especificada\n- \u2705 Persist\u00eancia SQLite\n- \u2705 Cleanup autom\u00e1tico de containers \u00f3rf\u00e3os\n\n## Instala\u00e7\u00e3o\n\n### Requisitos\n- Python 3.11+\n- Docker\n- pip\n\n### Setup\n```bash\ngit clone &lt;repo&gt;\ncd iot-simulator-api\npython3 -m venv venv\nsource venv/bin/activate\npip install -r requirements.txt\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#executar","title":"Executar","text":"<pre><code>uvicorn main:app --reload --port 8000\n</code></pre> <p>Aceder: http://localhost:8000/docs</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#uso","title":"Uso","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#criar-simulacao","title":"Criar Simula\u00e7\u00e3o","text":"<pre><code>curl -X POST http://localhost:8000/simulations \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"BROKER_URL\": \"test.mosquitto.org\",\n    \"BROKER_PORT\": 1883,\n    \"TIME_INTERVAL\": 10,\n    \"duration_minutes\": 30,\n    \"TOPICS\": [...]\n  }'\n</code></pre>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#listar-simulacoes","title":"Listar Simula\u00e7\u00f5es","text":"<pre><code>curl http://localhost:8000/simulations\n</code></pre>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#ver-logs","title":"Ver Logs","text":"<pre><code>curl http://localhost:8000/simulations/{id}/logs\n</code></pre>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#arquitetura","title":"Arquitetura","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Cliente   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 POST /simulations\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  FastAPI REST    \u2502\n\u2502  :8000           \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u251c\u2500\u2500\u25ba Docker Engine (cria container)\n     \u2502\n     \u2514\u2500\u2500\u25ba SQLite (guarda metadata)\n</code></pre>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#exemplos-de-config","title":"Exemplos de Config","text":"<p>Ver pasta <code>examples/</code> para configs prontos: - <code>factory.json</code> - Simula\u00e7\u00e3o industrial - <code>agriculture.json</code> - Sensores agr\u00edcolas - <code>smart-home.json</code> - Casa inteligente</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#troubleshooting","title":"Troubleshooting","text":"<p>Erro: Database disconnected <pre><code>rm simulations.db\npython3 -c \"from database import Base, engine; Base.metadata.create_all(bind=engine)\"\n</code></pre></p> <p>Container n\u00e3o para - Verificar <code>duration_minutes</code> foi especificado - Ver logs da API para mensagens \"[AUTO-STOP]\" <pre><code>#### Dia 17-18: Cliente HTML de Teste\n- [ ] HTML b\u00e1sico para conectar a broker MQTT\n- [ ] Usar MQTT.js para subscrever t\u00f3picos\n- [ ] Mostrar mensagens em tempo real\n- [ ] Adicionar gr\u00e1fico Chart.js (opcional)\n\n**Ficheiro `test-client/index.html`:**\n```html\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;IoT Simulator - Test Client&lt;/title&gt;\n    &lt;script src=\"https://unpkg.com/mqtt@5.3.5/dist/mqtt.min.js\"&gt;&lt;/script&gt;\n    &lt;style&gt;\n        body { font-family: Arial; max-width: 800px; margin: 50px auto; }\n        input { padding: 10px; width: 300px; }\n        button { padding: 10px 20px; }\n        #messages { \n            border: 1px solid #ccc; \n            height: 400px; \n            overflow-y: scroll; \n            padding: 10px; \n            margin-top: 20px;\n            font-family: monospace;\n        }\n        .message { padding: 5px; border-bottom: 1px solid #eee; }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h1&gt;\ud83d\udd0c IoT Simulator Test Client&lt;/h1&gt;\n\n    &lt;div&gt;\n        &lt;input id=\"broker\" placeholder=\"Broker (ex: test.mosquitto.org)\" value=\"test.mosquitto.org\"&gt;\n        &lt;input id=\"topic\" placeholder=\"Topic pattern (ex: fabrica/#)\" value=\"demo/#\"&gt;\n        &lt;button onclick=\"connect()\"&gt;Connect&lt;/button&gt;\n        &lt;button onclick=\"disconnect()\"&gt;Disconnect&lt;/button&gt;\n        &lt;button onclick=\"clearMessages()\"&gt;Clear&lt;/button&gt;\n    &lt;/div&gt;\n\n    &lt;div id=\"status\"&gt;Disconnected&lt;/div&gt;\n    &lt;div id=\"messages\"&gt;&lt;/div&gt;\n\n    &lt;script&gt;\n        let client = null;\n\n        function connect() {\n            const broker = document.getElementById('broker').value;\n            const topic = document.getElementById('topic').value;\n\n            if (client) client.end();\n\n            document.getElementById('status').textContent = 'Connecting...';\n\n            client = mqtt.connect(`ws://${broker}:8080`);\n\n            client.on('connect', () =&gt; {\n                document.getElementById('status').textContent = '\u2705 Connected';\n                client.subscribe(topic);\n                addMessage(`Subscribed to: ${topic}`, 'info');\n            });\n\n            client.on('message', (t, payload) =&gt; {\n                try {\n                    const data = JSON.parse(payload.toString());\n                    addMessage(`${t}: ${JSON.stringify(data, null, 2)}`, 'data');\n                } catch {\n                    addMessage(`${t}: ${payload.toString()}`, 'data');\n                }\n            });\n\n            client.on('error', (err) =&gt; {\n                document.getElementById('status').textContent = '\u274c Error';\n                addMessage(`Error: ${err.message}`, 'error');\n            });\n        }\n\n        function disconnect() {\n            if (client) {\n                client.end();\n                document.getElementById('status').textContent = 'Disconnected';\n                addMessage('Disconnected', 'info');\n            }\n        }\n\n        function clearMessages() {\n            document.getElementById('messages').innerHTML = '';\n        }\n\n        function addMessage(msg, type) {\n            const div = document.createElement('div');\n            div.className = `message ${type}`;\n            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;\n            document.getElementById('messages').appendChild(div);\n            div.scrollIntoView();\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#dia-19-21-configs-de-exemplo","title":"Dia 19-21: Configs de Exemplo","text":"<ul> <li>[ ] <code>examples/factory.json</code> - Linha de produ\u00e7\u00e3o</li> <li>[ ] <code>examples/agriculture.json</code> - Sensores agr\u00edcolas</li> <li>[ ] <code>examples/smart-home.json</code> - Casa inteligente</li> <li>[ ] <code>examples/fleet.json</code> - Gest\u00e3o de frota (GPS)</li> </ul> <p>Exemplo <code>examples/factory.json</code>: <pre><code>{\n  \"BROKER_URL\": \"test.mosquitto.org\",\n  \"BROKER_PORT\": 1883,\n  \"TIME_INTERVAL\": 5,\n  \"duration_minutes\": 10,\n  \"TOPICS\": [\n    {\n      \"TYPE\": \"multiple\",\n      \"PREFIX\": \"fabrica/maquina\",\n      \"RANGE_START\": 1,\n      \"RANGE_END\": 5,\n      \"DATA\": [\n        {\n          \"NAME\": \"producao_unidades\",\n          \"TYPE\": \"int\",\n          \"MIN_VALUE\": 50,\n          \"MAX_VALUE\": 100,\n          \"MAX_STEP\": 5,\n          \"INCREASE_PROBABILITY\": 0.6,\n          \"RETAIN_PROBABILITY\": 0.7\n        },\n        {\n          \"NAME\": \"temperatura_motor\",\n          \"TYPE\": \"float\",\n          \"MIN_VALUE\": 40.0,\n          \"MAX_VALUE\": 85.0,\n          \"MAX_STEP\": 2.5,\n          \"INCREASE_PROBABILITY\": 0.5,\n          \"RETAIN_PROBABILITY\": 0.8\n        },\n        {\n          \"NAME\": \"defeitos\",\n          \"TYPE\": \"int\",\n          \"MIN_VALUE\": 0,\n          \"MAX_VALUE\": 3,\n          \"MAX_STEP\": 1,\n          \"INCREASE_PROBABILITY\": 0.2,\n          \"RETAIN_PROBABILITY\": 0.95\n        }\n      ]\n    }\n  ]\n}\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#semana-4-apresentacao-e-demo","title":"Semana 4: Apresenta\u00e7\u00e3o e Demo","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#dia-22-23-slides-de-apresentacao","title":"Dia 22-23: Slides de Apresenta\u00e7\u00e3o","text":"<ul> <li>[ ] Slide 1: T\u00edtulo + Nome + Data</li> <li>[ ] Slide 2-3: Problema e Contexto</li> <li>[ ] Slide 4: Solu\u00e7\u00e3o Proposta</li> <li>[ ] Slide 5: Arquitetura T\u00e9cnica</li> <li>[ ] Slide 6: Stack Tecnol\u00f3gica</li> <li>[ ] Slide 7-8: Demo ao Vivo</li> <li>[ ] Slide 9: Features Implementadas</li> <li>[ ] Slide 10: Roadmap Futuro (Fase 2-3)</li> <li>[ ] Slide 11: Conclus\u00e3o</li> <li>[ ] Slide 12: Q&amp;A</li> </ul> <p>Template Slides (Markdown \u2192 reveal.js): <pre><code>---\ntitle: Plataforma de Simula\u00e7\u00e3o IoT\nauthor: [Teu Nome]\ndate: 2025\n---\n\n# Plataforma de Simula\u00e7\u00e3o IoT\n## API REST para Simula\u00e7\u00e3o sob Demanda\n\n[Teu Nome]  \nProjeto ISI - 2024/2025\n\n---\n\n## O Problema\n\n- Desenvolvimento IoT **custa 45.000-500.000 USD**\n- Setup de hardware **demora semanas**\n- Imposs\u00edvel testar cen\u00e1rios extremos\n- Riscos: danificar equipamento caro\n\n**Solu\u00e7\u00e3o:** Virtualizar sensores\n\n---\n\n## Solu\u00e7\u00e3o Proposta\n\n**API REST** que cria **simuladores MQTT** dinamicamente\n\n```bash\nPOST /simulations + JSON config\n\u2193\nContainer Docker inicia\n\u2193\nDados MQTT em tempo real\n</code></pre></p> <p>Benef\u00edcios: - Setup em &lt; 1 minuto - Custo: 0 EUR (usa broker p\u00fablico) - Cen\u00e1rios imposs\u00edveis no mundo real</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#arquitetura_1","title":"Arquitetura","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Cliente  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502 POST /simulations\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 FastAPI     \u2502\u2500\u2500\u25ba SQLite (metadata)\n\u2502 REST API    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2514\u2500\u2500\u25ba Docker Engine\n            \u2502\n            \u2514\u2500\u2500\u25ba mqtt-simulator container\n                 (publica MQTT)\n</code></pre>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#stack-tecnologica","title":"Stack Tecnol\u00f3gica","text":"<p>Backend: - Python 3.11 - FastAPI (API REST) - SQLAlchemy + SQLite - Docker SDK</p> <p>Simulador: - mqtt-simulator (imagem existente) - MQTT protocol - Random walk data generation</p> <p>Tools: - Swagger UI (documenta\u00e7\u00e3o autom\u00e1tica) - Postman (testes)</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#demo-ao-vivo","title":"Demo ao Vivo","text":"<ol> <li>Abrir Swagger UI</li> <li>POST criar simula\u00e7\u00e3o (factory.json)</li> <li>Ver container ativo: <code>docker ps</code></li> <li>Ver logs: <code>docker logs &lt;id&gt;</code></li> <li>Abrir cliente HTML</li> <li>Ver dados MQTT em tempo real</li> <li>Simula\u00e7\u00e3o para automaticamente</li> </ol>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#features-implementadas","title":"Features Implementadas","text":"<p>\u2705 API REST completa (CRUD) \u2705 Persist\u00eancia SQLite \u2705 Auto-stop ap\u00f3s dura\u00e7\u00e3o \u2705 Cleanup autom\u00e1tico \u2705 Swagger UI \u2705 Tratamento de erros robusto \u2705 Cliente de teste HTML \u2705 Configs de exemplo prontos  </p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#roadmap-futuro","title":"Roadmap Futuro","text":"<p>Fase 2 (4-6 semanas): - Kubernetes para multi-user - PostgreSQL - Isolamento por utilizador</p> <p>Fase 3 (8+ semanas): - Autentica\u00e7\u00e3o JWT - Billing e quotas - Monitoring (Prometheus/Grafana) - Deploy cloud (AWS/GCP)</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#conclusao","title":"Conclus\u00e3o","text":"<p>Objetivo Alcan\u00e7ado: - \u2705 MVP funcional - \u2705 Demonstra conceito - \u2705 C\u00f3digo limpo e documentado - \u2705 Extens\u00edvel (roadmap claro)</p> <p>Aprendizagens: - FastAPI + Docker integration - SQLAlchemy ORM - MQTT protocol - Container lifecycle management</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#perguntas","title":"Perguntas?","text":"<p>\ud83d\udce7 [teu-email]@example.com \ud83d\udd17 GitHub: [link-repo] \ud83d\udcc4 Documenta\u00e7\u00e3o: http://localhost:8000/docs <pre><code>#### Dia 24-25: Script e Ensaio de Demo\n- [ ] Escrever script palavra-a-palavra (7-10 minutos)\n- [ ] Ensaiar 3x sozinho\n- [ ] Gravar v\u00eddeo backup (se demo falhar)\n- [ ] Preparar dados de teste (n\u00e3o improvisar)\n\n**Script de Demo (7 minutos):**\n</code></pre> [00:00-01:00] Introdu\u00e7\u00e3o \"Bom dia. Hoje vou apresentar uma plataforma de simula\u00e7\u00e3o IoT que  permite testar aplica\u00e7\u00f5es sem hardware f\u00edsico.</p> <p>O problema: desenvolver IoT custa entre 45 mil e 500 mil d\u00f3lares, e demora semanas s\u00f3 para configurar sensores.</p> <p>A minha solu\u00e7\u00e3o: API REST que cria simuladores virtuais em segundos.\"</p> <p>[01:00-02:00] Mostrar Arquitetura \"A arquitetura \u00e9 simples: FastAPI recebe config JSON, cria container Docker com o simulador, e publica dados via MQTT.</p> <p>Stack: Python, FastAPI, Docker, SQLite para persist\u00eancia.\"</p> <p>[02:00-05:00] Demo ao Vivo \"Vou demonstrar. Aqui est\u00e1 o Swagger UI da API.</p> <ol> <li> <p>POST /simulations - vou criar uma simula\u00e7\u00e3o de f\u00e1brica    [Colar factory.json pr\u00e9-preparado]</p> </li> <li> <p>Executar... sucesso! Retornou simulation_id e container_id.</p> </li> <li> <p>Ver container ativo [terminal: docker ps]    Aqui est\u00e1, nome sim-abc123, a correr.</p> </li> <li> <p>Ver logs [terminal: docker logs sim-abc123]    Dados sendo publicados: fabrica/maquina1, maquina2...</p> </li> <li> <p>Abrir cliente HTML [browser]    Conectar ao broker... subscribed!    Dados chegam em tempo real, aqui temperatura, produ\u00e7\u00e3o, defeitos.</p> </li> <li> <p>Listar simula\u00e7\u00f5es [Swagger GET /simulations]    Aparece na base de dados, status running.</p> </li> <li> <p>Esta simula\u00e7\u00e3o est\u00e1 configurada para 2 minutos...    [esperar ou cortar] ...e para automaticamente.</p> </li> <li> <p>Se reiniciar a API [Ctrl+C, uvicorn main:app]    Containers \u00f3rf\u00e3os s\u00e3o limpos ao startup.\"</p> </li> </ol> <p>[05:00-06:00] C\u00f3digo \"Rapidamente o c\u00f3digo: main.py tem ~300 linhas. POST /simulations valida JSON com Pydantic, cria container Docker, guarda na BD, agenda auto-stop.</p> <p>Database.py - modelo SQLAlchemy simples, SQLite para persist\u00eancia.\"</p> <p>[06:00-07:00] Conclus\u00e3o \"Resumindo: sistema funcional que demonstra o conceito. MVP completo com persist\u00eancia, auto-stop, cleanup.</p> <p>Pr\u00f3ximos passos seriam adicionar Kubernetes para multi-user, autentica\u00e7\u00e3o, billing.</p> <p>Mas para esta fase, objetivo alcan\u00e7ado: API REST que cria simuladores sob demanda. Obrigado.\" <pre><code>#### Dia 26-28: Buffer e Polimento Final\n- [ ] Corrigir bugs encontrados durante ensaios\n- [ ] Melhorar mensagens de erro\n- [ ] Adicionar logs mais descritivos\n- [ ] Verificar todos requirements.txt\n- [ ] Limpar c\u00f3digo commented out\n- [ ] Formatar c\u00f3digo (black, autopep8)\n\n**Checklist Pr\u00e9-Apresenta\u00e7\u00e3o:**\n```bash\n# C\u00f3digo\n- [ ] Sem erros ao iniciar: uvicorn main:app\n- [ ] Swagger abre: http://localhost:8000/docs\n- [ ] Health check OK: curl http://localhost:8000/health\n- [ ] Criar simula\u00e7\u00e3o funciona com factory.json\n- [ ] Cliente HTML conecta e mostra dados\n\n# Documenta\u00e7\u00e3o\n- [ ] README.md completo e sem typos\n- [ ] Coment\u00e1rios em fun\u00e7\u00f5es cr\u00edticas\n- [ ] requirements.txt atualizado\n\n# Demo\n- [ ] factory.json testado e funciona\n- [ ] Cliente HTML funciona em browser fresh\n- [ ] Script impresso ou em tablet\n- [ ] V\u00eddeo backup gravado e testado\n- [ ] Slides exportados em PDF\n\n# Conting\u00eancia\n- [ ] Laptop carregado\n- [ ] Segundo laptop dispon\u00edvel\n- [ ] Internet backup (hotspot telem\u00f3vel)\n- [ ] Docker images pr\u00e9-downloaded\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#marco-apresentacao-fase-1","title":"\ud83c\udf93 MARCO: Apresenta\u00e7\u00e3o Fase 1","text":"<p>Entreg\u00e1veis M\u00ednimos: - \u2705 C\u00f3digo fonte funcionando - \u2705 README.md - \u2705 Slides apresenta\u00e7\u00e3o - \u2705 Demo ao vivo (ou v\u00eddeo backup)</p> <p>Crit\u00e9rios de Sucesso: - API cria simula\u00e7\u00f5es com config JSON - Containers Docker iniciam e publicam MQTT - Auto-stop funciona - Persist\u00eancia SQLite funciona - Cleanup de \u00f3rf\u00e3os funciona ao reiniciar</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#fase-2-kubernetes-multi-user-6-semanas","title":"FASE 2 - Kubernetes Multi-User (6 semanas)","text":"<p>Objetivo: Migrar para Kubernetes, suportar m\u00faltiplos utilizadores Pr\u00e9-requisitos: Fase 1 100% funcional, conhecimento b\u00e1sico K8s</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#semana-5-6-setup-kubernetes","title":"Semana 5-6: Setup Kubernetes","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#aprender-kubernetes-basico","title":"Aprender Kubernetes B\u00e1sico","text":"<ul> <li>[ ] Curso online (2-3 dias): Kubernetes for Beginners</li> <li>[ ] Conceitos: Pods, Deployments, Services, Namespaces</li> <li>[ ] kubectl comandos b\u00e1sicos</li> <li>[ ] Instalar minikube ou kind para testes locais</li> </ul> <p>Recursos: - Kubernetes.io tutorials - \"Kubernetes Up &amp; Running\" (livro) - KodeKloud free tier</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#setup-cluster-local","title":"Setup Cluster Local","text":"<ul> <li>[ ] Instalar minikube: <code>brew install minikube</code></li> <li>[ ] Iniciar cluster: <code>minikube start</code></li> <li>[ ] Testar: <code>kubectl get nodes</code></li> <li>[ ] Criar namespace: <code>kubectl create namespace simulations</code></li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#kubernetes-python-client","title":"Kubernetes Python Client","text":"<ul> <li>[ ] Instalar: <code>pip install kubernetes</code></li> <li>[ ] Testar conex\u00e3o: <pre><code>from kubernetes import client, config\nconfig.load_kube_config()\nv1 = client.CoreV1Api()\nprint(v1.list_pod_for_all_namespaces())\n</code></pre></li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#semana-7-8-migrar-docker-kubernetes","title":"Semana 7-8: Migrar Docker \u2192 Kubernetes","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#criar-pods-dinamicamente","title":"Criar Pods Dinamicamente","text":"<ul> <li>[ ] Refactor <code>create_simulation()</code> para usar K8s API</li> <li>[ ] Criar Pod spec para simulador</li> <li>[ ] Montar ConfigMap com JSON config</li> <li>[ ] Testar cria\u00e7\u00e3o de Pod</li> </ul> <p>C\u00f3digo-chave: <pre><code>from kubernetes import client, config\n\nconfig.load_kube_config()\nk8s = client.CoreV1Api()\n\ndef create_simulator_pod(sim_id: str, config_json: dict):\n    # Criar ConfigMap\n    configmap = client.V1ConfigMap(\n        metadata=client.V1ObjectMeta(name=f\"config-{sim_id}\"),\n        data={\"settings.json\": json.dumps(config_json)}\n    )\n    k8s.create_namespaced_config_map(\"simulations\", configmap)\n\n    # Criar Pod\n    pod = client.V1Pod(\n        metadata=client.V1ObjectMeta(name=f\"sim-{sim_id}\"),\n        spec=client.V1PodSpec(\n            containers=[\n                client.V1Container(\n                    name=\"simulator\",\n                    image=\"ghcr.io/damascenorafael/mqtt-simulator:sha-a73a2e8\",\n                    command=[\"-f\", \"/config/settings.json\"],\n                    volume_mounts=[\n                        client.V1VolumeMount(\n                            name=\"config\",\n                            mount_path=\"/config\"\n                        )\n                    ]\n                )\n            ],\n            volumes=[\n                client.V1Volume(\n                    name=\"config\",\n                    config_map=client.V1ConfigMapVolumeSource(\n                        name=f\"config-{sim_id}\"\n                    )\n                )\n            ],\n            restart_policy=\"Never\"\n        )\n    )\n\n    k8s.create_namespaced_pod(\"simulations\", pod)\n    return f\"sim-{sim_id}\"\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#expor-pods-via-service","title":"Expor Pods via Service","text":"<ul> <li>[ ] Criar Service para acesso externo</li> <li>[ ] Testar acesso MQTT via NodePort</li> <li>[ ] Documentar endpoint para utilizadores</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#cleanup-em-kubernetes","title":"Cleanup em Kubernetes","text":"<ul> <li>[ ] Implementar <code>delete_pod()</code> com K8s API</li> <li>[ ] Adicionar <code>activeDeadlineSeconds</code> aos Pods</li> <li>[ ] CronJob para limpar Pods expirados</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#semana-9-10-postgresql-e-multi-user","title":"Semana 9-10: PostgreSQL e Multi-User","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#migrar-sqlite-postgresql","title":"Migrar SQLite \u2192 PostgreSQL","text":"<ul> <li>[ ] Instalar PostgreSQL (Docker ou managed)</li> <li>[ ] Migra\u00e7\u00e3o schema (manual ou Alembic)</li> <li>[ ] Atualizar connection string</li> <li>[ ] Testar CRUD operations</li> </ul> <p>Migration script: <pre><code># migrate_to_postgres.py\nimport sqlite3\nimport psycopg2\n\n# Ler de SQLite\nsqlite_conn = sqlite3.connect('simulations.db')\nsqlite_cursor = sqlite_conn.cursor()\nrows = sqlite_cursor.execute(\"SELECT * FROM simulations\").fetchall()\n\n# Escrever em PostgreSQL\npg_conn = psycopg2.connect(\"postgresql://user:pass@localhost/iotsim\")\npg_cursor = pg_conn.cursor()\n\nfor row in rows:\n    pg_cursor.execute(\n        \"INSERT INTO simulations (...) VALUES (...)\",\n        row\n    )\n\npg_conn.commit()\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#adicionar-utilizadores","title":"Adicionar Utilizadores","text":"<ul> <li>[ ] Tabela <code>users</code> (id, email, password_hash)</li> <li>[ ] Endpoint POST /auth/register</li> <li>[ ] Endpoint POST /auth/login (retorna JWT)</li> <li>[ ] Middleware para verificar JWT</li> <li>[ ] Filtrar simula\u00e7\u00f5es por user_id</li> </ul> <p>Modelo User: <pre><code>class User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True)\n    email = Column(String, unique=True, nullable=False)\n    password_hash = Column(String, nullable=False)\n    created_at = Column(DateTime, default=datetime.utcnow)\n\n    simulations = relationship(\"Simulation\", back_populates=\"user\")\n\nclass Simulation(Base):\n    # ... campos existentes ...\n    user_id = Column(Integer, ForeignKey(\"users.id\"), nullable=False)\n    user = relationship(\"User\", back_populates=\"simulations\")\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#rate-limiting","title":"Rate Limiting","text":"<ul> <li>[ ] Instalar Redis</li> <li>[ ] Implementar rate limiter (5 simula\u00e7\u00f5es/hora/user)</li> <li>[ ] Middleware para verificar limites</li> <li>[ ] Retornar 429 Too Many Requests</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#fase-3-production-ready-6-semanas","title":"FASE 3 - Production Ready (6 semanas)","text":"<p>Objetivo: Sistema pronto para deploy real Pr\u00e9-requisitos: Fase 2 funcional, cluster K8s real</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#semana-11-12-autenticacao-e-seguranca","title":"Semana 11-12: Autentica\u00e7\u00e3o e Seguran\u00e7a","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#jwt-completo","title":"JWT Completo","text":"<ul> <li>[ ] Refresh tokens</li> <li>[ ] Logout (blacklist tokens)</li> <li>[ ] Password reset flow</li> <li>[ ] Email verification (opcional)</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#rbac-kubernetes","title":"RBAC Kubernetes","text":"<ul> <li>[ ] ServiceAccount para API</li> <li>[ ] Role com permiss\u00f5es m\u00ednimas</li> <li>[ ] RoleBinding</li> <li>[ ] Testar permiss\u00f5es</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#secrets-management","title":"Secrets Management","text":"<ul> <li>[ ] Kubernetes Secrets para DB password</li> <li>[ ] Secrets para JWT secret key</li> <li>[ ] N\u00e3o commitar secrets no Git</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#semana-13-14-monitoring-e-observability","title":"Semana 13-14: Monitoring e Observability","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#prometheus","title":"Prometheus","text":"<ul> <li>[ ] Instalar Prometheus no cluster</li> <li>[ ] Adicionar metrics na API (prometheus_client)</li> <li>[ ] Dashboards Grafana b\u00e1sicos</li> </ul> <p>M\u00e9tricas importantes: <pre><code>from prometheus_client import Counter, Histogram\n\nsimulations_created = Counter('simulations_created_total', 'Total sims')\nsimulation_duration = Histogram('simulation_duration_seconds', 'Duration')\npods_active = Gauge('pods_active', 'Active pods')\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#logging","title":"Logging","text":"<ul> <li>[ ] Structured logging (JSON)</li> <li>[ ] Loki para agrega\u00e7\u00e3o logs</li> <li>[ ] Queries \u00fateis em Grafana</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#semana-15-16-cicd-e-deploy","title":"Semana 15-16: CI/CD e Deploy","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#github-actions","title":"GitHub Actions","text":"<ul> <li>[ ] Pipeline: test \u2192 build \u2192 push image</li> <li>[ ] Deploy autom\u00e1tico ao push main</li> <li>[ ] Rollback autom\u00e1tico se falhar</li> </ul> <p>Exemplo <code>.github/workflows/deploy.yml</code>: <pre><code>name: Deploy\n\non:\n  push:\n    branches: [main]\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n\n    - name: Build Docker image\n      run: docker build -t iotsim-api:${{ github.sha }} .\n\n    - name: Push to registry\n      run: docker push iotsim-api:${{ github.sha }}\n\n    - name: Deploy to K8s\n      run: |\n        kubectl set image deployment/iotsim-api \\\n          api=iotsim-api:${{ github.sha }}\n</code></pre></p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#deploy-cloud","title":"Deploy Cloud","text":"<ul> <li>[ ] Escolher provider (DigitalOcean, Linode, AWS)</li> <li>[ ] Criar cluster managed Kubernetes</li> <li>[ ] Configurar DNS</li> <li>[ ] SSL/TLS (Let's Encrypt)</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#milestones-e-entregaveis","title":"Milestones e Entreg\u00e1veis","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#milestone-1-mvp-demo-semana-4","title":"Milestone 1: MVP Demo (Semana 4)","text":"<p>Entreg\u00e1veis: - C\u00f3digo fonte completo - README.md - API funcionando localmente - Demo gravada (backup) - Slides apresenta\u00e7\u00e3o</p> <p>Crit\u00e9rios de Sucesso: - [ ] API cria simula\u00e7\u00f5es - [ ] Auto-stop funciona - [ ] Persist\u00eancia funciona - [ ] Demo de 7 min ensaiada</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#milestone-2-kubernetes-working-semana-10","title":"Milestone 2: Kubernetes Working (Semana 10)","text":"<p>Entreg\u00e1veis: - C\u00f3digo migrado para K8s - Manifests YAML - PostgreSQL funcional - Multi-user b\u00e1sico</p> <p>Crit\u00e9rios de Sucesso: - [ ] Pods criados dinamicamente - [ ] M\u00faltiplos users isolados - [ ] Rate limiting funciona - [ ] Documenta\u00e7\u00e3o atualizada</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#milestone-3-production-deploy-semana-16","title":"Milestone 3: Production Deploy (Semana 16)","text":"<p>Entreg\u00e1veis: - Sistema deployed em cloud - CI/CD funcional - Monitoring setup - Documenta\u00e7\u00e3o completa</p> <p>Crit\u00e9rios de Sucesso: - [ ] API acess\u00edvel publicamente - [ ] SSL/TLS configurado - [ ] Logs e m\u00e9tricas vis\u00edveis - [ ] Zero-downtime deploys</p>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#checklists-de-validacao","title":"Checklists de Valida\u00e7\u00e3o","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#checklist-fase-1-antes-de-apresentar","title":"Checklist Fase 1 (antes de apresentar)","text":"<pre><code>Funcionalidade:\n- [ ] POST /simulations cria container Docker\n- [ ] GET /simulations lista todas\n- [ ] GET /simulations/{id} mostra detalhes + logs\n- [ ] DELETE /simulations/{id} para container\n- [ ] Container para ap\u00f3s duration_minutes\n- [ ] Containers \u00f3rf\u00e3os limpos ao reiniciar API\n\nBase de Dados:\n- [ ] Simula\u00e7\u00f5es persistem ap\u00f3s restart\n- [ ] Status atualiza corretamente (running\u2192expired\u2192stopped)\n- [ ] expires_at calculado e usado\n- [ ] Ficheiros config tempor\u00e1rios limpos\n\nQualidade:\n- [ ] Erros retornam HTTP status corretos\n- [ ] Swagger UI funciona e est\u00e1 completo\n- [ ] C\u00f3digo sem warnings/erros\n- [ ] README.md completo\n\nDemo:\n- [ ] factory.json funciona\n- [ ] Cliente HTML conecta e mostra dados\n- [ ] Script de 7 min ensaiado 3x\n- [ ] V\u00eddeo backup gravado\n</code></pre>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#checklist-fase-2-antes-de-migrar-para-fase-3","title":"Checklist Fase 2 (antes de migrar para Fase 3)","text":"<pre><code>Kubernetes:\n- [ ] Pods criados dinamicamente via K8s API\n- [ ] ConfigMaps montados corretamente\n- [ ] Pods param ap\u00f3s activeDeadlineSeconds\n- [ ] CronJob limpa Pods expirados\n\nMulti-User:\n- [ ] PostgreSQL substituiu SQLite\n- [ ] Tabela users existe e funciona\n- [ ] JWT authentication funciona\n- [ ] Users s\u00f3 v\u00eaem suas simula\u00e7\u00f5es\n- [ ] Rate limiting por user funciona\n\nRobustez:\n- [ ] RBAC K8s configurado\n- [ ] Secrets geridos corretamente\n- [ ] Error handling robusto\n- [ ] Documenta\u00e7\u00e3o atualizada\n</code></pre>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#checklist-fase-3-antes-de-considerar-pronto","title":"Checklist Fase 3 (antes de considerar \"pronto\")","text":"<pre><code>Produ\u00e7\u00e3o:\n- [ ] Deploy em cloud p\u00fablica\n- [ ] DNS configurado\n- [ ] SSL/TLS ativo\n- [ ] Logs agregados (Loki/ELK)\n- [ ] M\u00e9tricas vis\u00edveis (Grafana)\n- [ ] Alertas configurados\n\nDevOps:\n- [ ] CI/CD funcional\n- [ ] Testes automatizados\n- [ ] Rollback funciona\n- [ ] Backups database autom\u00e1ticos\n\nSeguran\u00e7a:\n- [ ] Secrets n\u00e3o no Git\n- [ ] RBAC m\u00ednimo necess\u00e1rio\n- [ ] Network policies configuradas\n- [ ] Security scan passou\n</code></pre>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#metricas-de-sucesso","title":"\ud83d\udcc8 M\u00e9tricas de Sucesso","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#fase-1-mvp","title":"Fase 1 (MVP)","text":"<ul> <li>Funcionalidade: 100% dos endpoints funcionam</li> <li>Performance: API responde &lt; 200ms (P95)</li> <li>Confiabilidade: 0 crashes durante demo</li> <li>Documenta\u00e7\u00e3o: README completo + coment\u00e1rios</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#fase-2-kubernetes","title":"Fase 2 (Kubernetes)","text":"<ul> <li>Escalabilidade: Suporta 10+ utilizadores simult\u00e2neos</li> <li>Isolamento: Users n\u00e3o v\u00eaem simula\u00e7\u00f5es de outros</li> <li>Performance: 50+ pods criados sem degrada\u00e7\u00e3o</li> <li>Confiabilidade: Cleanup 100% eficaz</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#fase-3-producao","title":"Fase 3 (Produ\u00e7\u00e3o)","text":"<ul> <li>Uptime: 99%+ SLA</li> <li>Deploy: &lt; 5 min do commit ao prod</li> <li>Observability: Logs e m\u00e9tricas 100% cobertura</li> <li>Seguran\u00e7a: 0 vulnerabilidades cr\u00edticas</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#proximos-passos-imediatos-esta-semana","title":"Pr\u00f3ximos Passos Imediatos (Esta Semana)","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#segunda-feira","title":"Segunda-feira","text":"<ul> <li>[ ] Corrigir health check database</li> <li>[ ] Adicionar campo expires_at</li> <li>[ ] Implementar cleanup_expired_simulations()</li> <li>[ ] Testar: criar simula\u00e7\u00e3o 2 min \u2192 para sozinha</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#terca-feira","title":"Ter\u00e7a-feira","text":"<ul> <li>[ ] Testar: reiniciar API \u2192 \u00f3rf\u00e3os limpos</li> <li>[ ] Adicionar filtros GET /simulations?status=running</li> <li>[ ] Adicionar GET /stats</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#quarta-feira","title":"Quarta-feira","text":"<ul> <li>[ ] Come\u00e7ar README.md</li> <li>[ ] Criar factory.json de exemplo</li> <li>[ ] Testar todos endpoints com Postman</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#quinta-feira","title":"Quinta-feira","text":"<ul> <li>[ ] Cliente HTML b\u00e1sico</li> <li>[ ] Testar cliente com simula\u00e7\u00e3o real</li> <li>[ ] Come\u00e7ar slides apresenta\u00e7\u00e3o</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#sexta-feira","title":"Sexta-feira","text":"<ul> <li>[ ] Finalizar slides</li> <li>[ ] Ensaiar demo 1x</li> <li>[ ] Identificar gaps/bugs</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#recursos-uteis","title":"Recursos \u00dateis","text":""},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#documentacao-oficial","title":"Documenta\u00e7\u00e3o Oficial","text":"<ul> <li>FastAPI: https://fastapi.tiangolo.com</li> <li>Docker SDK: https://docker-py.readthedocs.io</li> <li>SQLAlchemy: https://docs.sqlalchemy.org</li> <li>Kubernetes Python: https://github.com/kubernetes-client/python</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#tutoriais","title":"Tutoriais","text":"<ul> <li>FastAPI + Docker: https://testdriven.io/blog/fastapi-docker/</li> <li>Kubernetes Basics: https://kubernetes.io/docs/tutorials/</li> <li>MQTT.js: https://github.com/mqttjs/MQTT.js</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#tools","title":"Tools","text":"<ul> <li>Postman: Testar API</li> <li>Swagger UI: Documenta\u00e7\u00e3o autom\u00e1tica</li> <li>Docker Desktop: Gerir containers</li> <li>minikube: Kubernetes local</li> </ul>"},{"location":"fase-2/roadmap-Iot-Simulator-Platform/#conclusao_1","title":"Conclus\u00e3o","text":"<p>Este roadmap cobre 12-16 semanas de desenvolvimento estruturado em 3 fases:</p> <ol> <li>Fase 1 (4 semanas): MVP funcional para apresenta\u00e7\u00e3o universit\u00e1ria \u2190 FOCO ATUAL</li> <li>Fase 2 (6 semanas): Kubernetes + multi-user</li> <li>Fase 3 (6 semanas): Produ\u00e7\u00e3o com CI/CD, monitoring</li> </ol> <p>Recomenda\u00e7\u00e3o: Completar Fase 1 perfeitamente antes de pensar em Fase 2. Um MVP bem executado vale mais que features incompletas.</p> <p>Pr\u00f3xima A\u00e7\u00e3o: Seguir checklist \"Pr\u00f3ximos Passos Imediatos\" acima.</p>"},{"location":"simulador/configuration/","title":"Configuration","text":"<p>The MQTT Simulator configuration consists of 3 main sections: Broker, Topics, and Data.</p> <p>Quick Navigation: Broker settings \u2022 Topics settings \u2022 Data settings</p> <p>You can also check a full settings file example at: settings.json.</p>"},{"location":"simulador/configuration/#broker-settings","title":"Broker settings","text":"<p>The Broker settings section is located at the root level of the JSON configuration file and defines the fundamental MQTT connection parameters:</p> <pre><code>{\n    \"BROKER_URL\": \"mqtt.eclipse.org\",\n    \"BROKER_PORT\": 1883,\n    \"TOPICS\": [\n        ...\n    ]\n}\n</code></pre> Key Type Default Description <code>BROKER_URL</code> string localhost The broker URL where the data will be published <code>BROKER_PORT</code> number 1883 The port used by the broker <code>PROTOCOL_VERSION</code> number 4 Sets the paho.mqtt.client <code>protocol</code> param. Version of the MQTT protocol to use for this client. Can be either <code>3</code> (MQTTv31), <code>4</code> (MQTTv311) or <code>5</code> (MQTTv5) <code>TLS_CA_PATH</code> string None Sets the paho.mqtt.client.tls_set <code>ca_certs</code> param. String path to the Certificate Authority certificate file <code>TLS_CERT_PATH</code> string None Sets the paho.mqtt.client.tls_set <code>certfile</code> param. String path to the PEM encoded client certificate file <code>TLS_KEY_PATH</code> string None Sets the paho.mqtt.client.tls_set <code>keyfile</code> param. String path to the PEM encoded client private keys file <code>AUTH_USERNAME</code> string None Sets the paho.mqtt.client.username_pw_set <code>username</code> param. Username to authenticate with <code>AUTH_PASSWORD</code> string None Sets the paho.mqtt.client.username_pw_set <code>password</code> param. Password to authenticate with <code>CLEAN_SESSION</code> bool True Sets the paho.mqtt.client <code>clean_session</code> param. Boolean that determines the client type. This property is ignored if <code>PROTOCOL_VERSION</code> is <code>5</code>. <code>RETAIN</code> bool False Sets the paho.mqtt.client.publish <code>retain</code> param. If set to true, the message will be set as the \u201clast known good\u201d/retained message for the topic <code>QOS</code> number 2 Sets the paho.mqtt.client.publish <code>qos</code> param. Quality of service level to use <code>TIME_INTERVAL</code> number 10 Time interval in seconds between submissions towards the topic <code>TOPICS</code> array\\"},{"location":"simulador/configuration/#topics-settings","title":"Configura\u00e7\u00e3o","text":""},{"location":"simulador/configuration/#data-settings","title":"Configura\u00e7\u00e3o","text":""},{"location":"simulador/how_to_use_simulator/","title":"MQTT Simulator","text":"<p>A lightweight, easy-to-configure MQTT simulator written in Python 3 for publishing JSON objects to a broker, simulating sensors and devices.</p> <p>Features \u2022 Getting Started \u2022 Configuration \u2022 Main contributors</p> <p></p>"},{"location":"simulador/how_to_use_simulator/#features","title":"Features","text":"<ul> <li>Lightweight and easy-to-configure simulator for publishing data to an MQTT broker</li> <li>Simple setup with a single JSON configuration file</li> <li>Publish data on predefined fixed topics</li> <li>Publish data on multiple topics that have a variable id or items at the end</li> <li>Simulated random variation of data based on configurable parameters</li> <li>Real-time event logging during simulation</li> </ul>"},{"location":"simulador/how_to_use_simulator/#getting-started","title":"Getting Started","text":""},{"location":"simulador/how_to_use_simulator/#running-using-python","title":"Running using Python","text":"<p>Run the simulator with the default settings file (<code>config/settings.json</code>):</p> <pre><code>python3 mqtt-simulator/main.py \n</code></pre> <p>Or specify a custom settings file:</p> <pre><code>python3 mqtt-simulator/main.py -f &lt;path/settings.json&gt;\n</code></pre> <p>To install all dependencies with a virtual environment before using:</p> <pre><code>python3 -m venv venv\nsource venv/bin/activate\npip3 install -r requirements.txt\n</code></pre>"},{"location":"simulador/how_to_use_simulator/#running-using-uv","title":"Running using uv","text":"<p>Run the simulator with uv, a fast Python package and project manager - no need to manually setup a virtual environment:</p> <pre><code>uv run mqtt-simulator/main.py -f &lt;path/settings.json&gt;\n</code></pre>"},{"location":"simulador/how_to_use_simulator/#running-using-docker","title":"Running using Docker","text":"<p>Additionally, you can run the simulator via Docker using the provided <code>Dockerfile</code>.</p> <p>Build the image:</p> <pre><code>docker build -t mqtt-simulator .\n</code></pre> <p>Run the container:</p> <pre><code>docker run mqtt-simulator -f &lt;path/settings.json&gt;\n</code></pre>"},{"location":"simulador/how_to_use_simulator/#configuration","title":"Configuration","text":"<p>See the configuration documentation for detailed usage instructions.</p> <p>You can also check a full settings file example at: settings.json.</p> <p>Below is a minimal configuration file that connects to the <code>mqtt.eclipseprojects.io</code> broker and publishes data to the <code>/place/roof</code> and <code>/place/basement</code> topics. The simulator generates <code>temperature</code> variations based on the provided parameters:</p> <pre><code>{\n  \"BROKER_URL\": \"mqtt.eclipseprojects.io\",\n  \"TOPICS\": [\n    {\n      \"TYPE\": \"list\",\n      \"PREFIX\": \"place\",\n      \"LIST\": [\"roof\", \"basement\"],\n      \"TIME_INTERVAL\": 8,\n      \"DATA\": [\n        {\n          \"NAME\": \"temperature\",\n          \"TYPE\": \"float\",\n          \"MIN_VALUE\": 20,\n          \"MAX_VALUE\": 55,\n          \"MAX_STEP\": 3,\n          \"RETAIN_PROBABILITY\": 0.5,\n          \"INCREASE_PROBABILITY\": 0.6\n        }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"simulador/how_to_use_simulator/#sensores-simulados","title":"Sensores Simulados","text":"Sensor Tipo de   dado Unidade Intervalo   de emiss\u00e3o Exemplo de   payload Produ\u00e7\u00e3o Pe\u00e7as por   minuto pcs/min 5 s {   \"estacao\": 1, \"producao\": 58 } Paragem Tempo parado segundos evento {   \"estacao\": 1, \"paragem\": 15 } Stock N\u00edvel de   stock % 10 s {   \"estacao\": 1, \"stock\": 73 } Qualidade Pe\u00e7as   defeituosas % 10 s {   \"estacao\": 1, \"defeitos\": 4 }"},{"location":"simulador/math_expression/","title":"MQTT Simulator - Data type <code>math_expression</code>","text":"<p>For general information on how to configure the MQTT Simulator see the README.md file.</p> <p>For <code>TYPE: \"math_expression\"</code> we need five required configuration parameters: <code>MATH_EXPRESSION</code>, <code>INTERVAL_START</code>, <code>INTERVAL_END</code>, <code>MIN_DELTA</code> and <code>MAX_DELTA</code>. Each of these have some notes:</p> <pre><code>{\n    ... \n    \"TYPE\": \"math_expression\",\n    \"MATH_EXPRESSION\": \"x**2\",\n    \"INTERVAL_START\": 30,\n    \"INTERVAL_END\": 40,\n    \"MIN_DELTA\": 0.1,\n    \"MAX_DELTA\": 0.2,\n    ...\n}\n</code></pre> <ul> <li><code>MATH_EXPRESSION</code>:</li> <li></li> <li>The <code>MATH_EXPRESSION</code>'s variable must be defined as <code>x</code>.</li> <li> <p>Any Pythonic expression is valid, so, for instance, if you declare it as <code>x**2</code> or <code>math.pow(x,2)</code> the generated function will be the same.</p> </li> <li> <p><code>INTERVAL_START</code> and <code>INTERVAL_END</code>:</p> </li> <li> <p>These parameters will works as the function domain, restricting the value that <code>x</code> can reach.</p> </li> <li> <p>When the variable <code>x &gt; INTERVAL_END</code>, the function will be evaluated, and then the variable will be reset to <code>x=INTERVAL_START</code>. So keep in mind that the real interval is <code>[INTERVAL_START,INTERVAL_END+MAX_DELTA)</code>.</p> </li> <li> <p><code>MIN_DELTA</code> and <code>MAX_DELTA</code>:</p> </li> <li>It is possible to set both with the same value, in this case, it is expected that the curves are more similar between the \"loops\", and may be identical if <code>RETAIN_PROBABILITY = 0</code>.</li> </ul>"},{"location":"simulador/math_expression/#example-1-freezer-temperature","title":"Example 1 - Freezer Temperature","text":"<p>In the example below the <code>MATH_EXPRESION</code> = $2x\u00b2+1$, <code>INTERVAL_START = 0</code>, <code>INTERVAL_END = 5</code>, <code>MIN_DELTA = 0</code> and <code>MAX_DELTA = 0.5</code>, so it is expected that the generated values are between 1 and 61.5, and the curves should be slightly different.</p> <pre><code> {\n    \"TYPE\": \"single\",\n    \"PREFIX\": \"freezer\",\n    \"TIME_INTERVAL\": 6,\n    \"DATA\": [\n        {\n            \"NAME\": \"temperature\",\n            \"TYPE\": \"math_expression\",\n            \"RETAIN_PROBABILITY\": 0.1,\n            \"MATH_EXPRESSION\": \"2*math.pow(x,2)+1\",\n            \"INTERVAL_START\": 0,\n            \"INTERVAL_END\": 5,\n            \"MIN_DELTA\": 0.5,\n            \"MAX_DELTA\": 0.5\n        }\n    ]\n}\n</code></pre> <p></p>"},{"location":"simulador/math_expression/#example-2-car-velocity","title":"Example 2 - Car Velocity","text":"<p>In the example below the <code>MATH_EXPRESION</code> = $\\sqrt{75x}$, <code>INTERVAL_START = 0</code>, <code>INTERVAL_END = 100</code>, <code>MIN_DELTA = 10</code> and <code>MAX_DELTA = 10</code>, so it is expected that the generated values are between 0 and 87. As <code>REATIN_PROBABILITY = 0</code> and the <code>MIN_DELTA</code> and <code>MAX_DELTA</code> are identicals, the curves must be identicals.</p> <pre><code>{\n    \"TYPE\": \"single\",\n    \"PREFIX\": \"car\",\n    \"TIME_INTERVAL\": 6,\n    \"DATA\": [\n        {\n            \"NAME\": \"velocity\",\n            \"TYPE\": \"math_expression\",\n            \"RETAIN_PROBABILITY\": 0,\n            \"MATH_EXPRESSION\": \"(75*x)**(1/2)\",\n            \"INTERVAL_START\": 0,\n            \"INTERVAL_END\": 100,\n            \"MIN_DELTA\": 10,\n            \"MAX_DELTA\": 10\n        }\n    ]\n}\n</code></pre> <p></p>"}]}